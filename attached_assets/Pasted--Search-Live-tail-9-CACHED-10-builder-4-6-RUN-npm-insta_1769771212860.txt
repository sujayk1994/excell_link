
Search

Live tail



#9 CACHED
#10 [builder 4/6] RUN npm install
#10 sha256:c02d17997ce3d2c82e082235ea0b5152d06ee659c4e2fabcf1e0079312f1bcde 28.23MB / 28.23MB 0.1s done
#10 extracting sha256:c02d17997ce3d2c82e082235ea0b5152d06ee659c4e2fabcf1e0079312f1bcde
#10 extracting sha256:c02d17997ce3d2c82e082235ea0b5152d06ee659c4e2fabcf1e0079312f1bcde 0.8s done
#10 sha256:024b9523dc7f8055cf2750f04c65434cae8f1b05241e73a5f0878d117366ad8a 3.31kB / 3.31kB done
#10 extracting sha256:024b9523dc7f8055cf2750f04c65434cae8f1b05241e73a5f0878d117366ad8a
#10 extracting sha256:024b9523dc7f8055cf2750f04c65434cae8f1b05241e73a5f0878d117366ad8a 3.8s done
#10 sha256:ebe53019ce11f9bf83b30d24ab04d6dc4aa05dedf8c520e04da0559608edeade 37.75MB / 40.98MB 0.2s
#10 sha256:ebe53019ce11f9bf83b30d24ab04d6dc4aa05dedf8c520e04da0559608edeade 40.98MB / 40.98MB 0.3s done
#10 extracting sha256:ebe53019ce11f9bf83b30d24ab04d6dc4aa05dedf8c520e04da0559608edeade
#10 extracting sha256:ebe53019ce11f9bf83b30d24ab04d6dc4aa05dedf8c520e04da0559608edeade 5.6s done
#10 sha256:a98168ca575a7f9a177a9348c0ff4ed8e5c9ca39eb648a0654dd3c29928412cf 1.71MB / 1.71MB 0.1s done
#10 extracting sha256:a98168ca575a7f9a177a9348c0ff4ed8e5c9ca39eb648a0654dd3c29928412cf
#10 extracting sha256:a98168ca575a7f9a177a9348c0ff4ed8e5c9ca39eb648a0654dd3c29928412cf 4.7s done
#10 sha256:7d393bf487b04ce90e509f8c13715578b3c9785f7aa2ba9bcd797b5a50c0e731 446B / 446B done
#10 extracting sha256:7d393bf487b04ce90e509f8c13715578b3c9785f7aa2ba9bcd797b5a50c0e731
#10 extracting sha256:7d393bf487b04ce90e509f8c13715578b3c9785f7aa2ba9bcd797b5a50c0e731 0.2s done
#10 sha256:e6cf10469162e90b724467a220622b5cf96efdb3ea99f33210f689896dde26f0 92B / 92B done
#10 extracting sha256:e6cf10469162e90b724467a220622b5cf96efdb3ea99f33210f689896dde26f0 0.0s done
#10 sha256:2edbcd08d7f091715aaa14405adf235bfb256f862944a80e11b518c5fa8de64f 70.50kB / 70.50kB done
#10 extracting sha256:2edbcd08d7f091715aaa14405adf235bfb256f862944a80e11b518c5fa8de64f 0.0s done
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 33.33MB / 158.76MB 0.2s
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 68.16MB / 158.76MB 0.3s
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 100.66MB / 158.76MB 0.5s
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 125.90MB / 158.76MB 0.6s
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 158.76MB / 158.76MB 0.8s
#10 sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 158.76MB / 158.76MB 1.4s done
#10 extracting sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b
#10 extracting sha256:ca008506ad6f54eef15890e19781f1b2ca2180ca63fb2e461ad18343dd5d421b 13.7s done
#10 CACHED
#11 [builder 5/6] COPY . .
#11 DONE 2.0s
#12 [builder 6/6] RUN npm run build
#12 0.322 
#12 0.322 > rest-express@1.0.0 build
#12 0.322 > tsx script/build.ts
#12 0.322 
#12 1.022 building client...
#12 1.100 vite v7.3.0 building client environment for production...
#12 1.601 transforming...
#12 5.640 ✓ 2324 modules transformed.
#12 5.938 rendering chunks...
#12 5.948 computing gzip size...
#12 5.961 ../dist/public/index.html                   2.01 kB │ gzip:   0.77 kB
#12 5.961 ../dist/public/assets/logo-CONtvC5f.jpg    38.21 kB
#12 5.961 ../dist/public/assets/index-Dofq2t-T.css   71.18 kB │ gzip:  11.72 kB
#12 5.961 ../dist/public/assets/index-gcyQRyi2.js   474.81 kB │ gzip: 148.89 kB
#12 5.961 ✓ built in 4.67s
#12 5.962 building server...
#12 6.299 
#12 6.299   dist/index.cjs  2.4mb ⚠️
#12 6.299 
#12 6.299 ⚡ Done in 325ms
#12 DONE 8.1s
#13 [stage-1 3/6] COPY --from=builder /app/dist ./dist
#13 CACHED
#14 [stage-1 4/6] COPY --from=builder /app/package*.json ./
#14 CACHED
#15 [stage-1 5/6] RUN npm install --omit=dev
#15 CACHED
#16 [stage-1 6/6] RUN mkdir -p uploads
#16 sha256:970eafa75dd62370b72909c30aae7bd97b230d8e9c1f468355228b11d5b5afea 937.37kB / 937.37kB 0.0s done
#16 extracting sha256:970eafa75dd62370b72909c30aae7bd97b230d8e9c1f468355228b11d5b5afea 0.1s done
#16 sha256:45bc14b200e79813fcc31eb70cd503f3c0fdc6713b80cae67e1b13c5266dbb78 70.50kB / 70.50kB done
#16 extracting sha256:45bc14b200e79813fcc31eb70cd503f3c0fdc6713b80cae67e1b13c5266dbb78 0.0s done
#16 sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f 29.36MB / 90.88MB 0.2s
#16 sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f 66.83MB / 90.88MB 0.3s
#16 sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f 90.88MB / 90.88MB 0.5s
#16 sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f 90.88MB / 90.88MB 0.6s done
#16 extracting sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f
#16 extracting sha256:412d5008c700e506ddcb560be70c0b274eb5356d148bb436572de94cddea955f 8.9s done
#16 sha256:1c8503fc15bd776c1f8c58984a99743c55990f349aed41b65484235cbfd256c4 115B / 115B done
#16 extracting sha256:1c8503fc15bd776c1f8c58984a99743c55990f349aed41b65484235cbfd256c4
#16 extracting sha256:1c8503fc15bd776c1f8c58984a99743c55990f349aed41b65484235cbfd256c4 0.9s done
#16 CACHED
#17 exporting to docker image format
#17 exporting layers done
#17 exporting manifest sha256:a1102eccd6a9751b2ceee5aec675d985d842778214fa53d971baa599f92b0b96 0.0s done
#17 exporting config sha256:8bd953a18bc020229ba506a31b9c365786b23204202f49c7c75b8156fa0928ae 0.0s done
#17 DONE 1.0s
#18 exporting cache to client directory
#18 preparing build cache for export
#18 writing cache image manifest sha256:7493d939261c88acf889079aae6c36f3a760ac25d46f47ecc5dd5569bdf4d037 0.0s done
#18 DONE 0.4s
Pushing image to registry...
Upload succeeded
==> Deploying...
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
/app/dist/index.cjs:212
/app/dist/index.cjs:212
/app/dist/index.cjs:212
		`;await t.execute(Y`CREATE SCHEMA IF NOT EXISTS ${Y.identifier(u)}`),await t.execute(d);let w=(await t.all(Y`select id, hash, created_at from ${Y.identifier(u)}.${Y.identifier(c)} order by created_at desc limit 1`))[0];await t.transaction(async y=>{for await(let g of r)if(!w||Number(w.created_at)<g.folderMillis){for(let _ of g.sql)await y.execute(Y.raw(_));await y.execute(Y`insert into ${Y.identifier(u)}.${Y.identifier(c)} ("hash", "created_at") values(${g.hash}, ${g.folderMillis})`)}})}escapeName(r){return`"${r}"`}escapeParam(r){return`$${r+1}`}escapeString(r){return`'${r.replace(/'/g,"''")}'`}buildWithCTE(r){if(!r?.length)return;let t=[Y`with `];for(let[e,c]of r.entries())t.push(Y`${Y.identifier(c._.alias)} as (${c._.sql})`),e<r.length-1&&t.push(Y`, `);return t.push(Y` `),Y.join(t)}buildDeleteQuery({table:r,where:t,returning:e,withList:c}){let u=this.buildWithCTE(c),d=e?Y` returning ${this.buildSelection(e,{isSingleTable:!0})}`:void 0,m=t?Y` where ${t}`:void 0;return Y`${u}delete from ${r}${m}${d}`}buildUpdateSet(r,t){let e=r[Ze.Symbol.Columns],c=Object.keys(e).filter(d=>t[d]!==void 0||e[d]?.onUpdateFn!==void 0),u=c.length;return Y.join(c.flatMap((d,m)=>{let w=e[d],y=t[d]??Y.param(w.onUpdateFn(),w),g=Y`${Y.identifier(this.casing.getColumnCasing(w))} = ${y}`;return m<u-1?[g,Y.raw(", ")]:[g]}))}buildUpdateQuery({table:r,set:t,where:e,returning:c,withList:u,from:d,joins:m}){let w=this.buildWithCTE(u),y=r[ra.Symbol.Name],g=r[ra.Symbol.Schema],_=r[ra.Symbol.OriginalName],S=y===_?void 0:y,O=Y`${g?Y`${Y.identifier(g)}.`:void 0}${Y.identifier(_)}${S&&Y` ${Y.identifier(S)}`}`,H=this.buildUpdateSet(r,t),N=d&&Y.join([Y.raw(" from "),this.buildFromTable(d)]),z=this.buildJoins(m),se=c?Y` returning ${this.buildSelection(c,{isSingleTable:!d})}`:void 0,we=e?Y` where ${e}`:void 0;return Y`${w}update ${O} set ${H}${N}${z}${we}${se}`}buildSelection(r,{isSingleTable:t=!1}={}){let e=r.length,c=r.flatMap(({field:u},d)=>{let m=[];if(ge(u,at.Aliased)&&u.isSelectionField)m.push(Y.identifier(u.fieldAlias));else if(ge(u,at.Aliased)||ge(u,at)){let w=ge(u,at.Aliased)?u.sql:u;t?m.push(new at(w.queryChunks.map(y=>ge(y,Ve)?Y.identifier(this.casing.getColumnCasing(y)):y))):m.push(w),ge(u,at.Aliased)&&m.push(Y` as ${Y.identifier(u.fieldAlias)}`)}else ge(u,Qt)&&(t?m.push(Y.identifier(this.casing.getColumnCasing(u))):m.push(u));return d<e-1&&m.push(Y`, `),m});return Y.join(c)}buildJoins(r){if(!r||r.length===0)return;let t=[];for(let[e,c]of r.entries()){e===0&&t.push(Y` `);let u=c.table,d=c.lateral?Y` lateral`:void 0;if(ge(u,ra)){let m=u[ra.Symbol.Name],w=u[ra.Symbol.Schema],y=u[ra.Symbol.OriginalName],g=m===y?void 0:c.alias;t.push(Y`${Y.raw(c.joinType)} join${d} ${w?Y`${Y.identifier(w)}.`:void 0}${Y.identifier(y)}${g&&Y` ${Y.identifier(g)}`} on ${c.on}`)}else if(ge(u,Ca)){let m=u[sr].name,w=u[sr].schema,y=u[sr].originalName,g=m===y?void 0:c.alias;t.push(Y`${Y.raw(c.joinType)} join${d} ${w?Y`${Y.identifier(w)}.`:void 0}${Y.identifier(y)}${g&&Y` ${Y.identifier(g)}`} on ${c.on}`)}else t.push(Y`${Y.raw(c.joinType)} join${d} ${u} on ${c.on}`);e<r.length-1&&t.push(Y` `)}return Y.join(t)}buildFromTable(r){if(ge(r,Ze)&&r[Ze.Symbol.OriginalName]!==r[Ze.Symbol.Name]){let t=Y`${Y.identifier(r[Ze.Symbol.OriginalName])}`;return r[Ze.Symbol.Schema]&&(t=Y`${Y.identifier(r[Ze.Symbol.Schema])}.${t}`),Y`${t} ${Y.identifier(r[Ze.Symbol.Name])}`}return r}buildSelectQuery({withList:r,fields:t,fieldsFlat:e,where:c,having:u,table:d,joins:m,orderBy:w,groupBy:y,limit:g,offset:_,lockingClause:S,distinct:O,setOperators:H}){let N=e??bn(t);for(let dt of N)if(ge(dt.field,Qt)&&ja(dt.field.table)!==(ge(d,jr)?d._.alias:ge(d,xc)?d[sr].name:ge(d,at)?void 0:ja(d))&&!(zt=>m?.some(({alias:mt})=>mt===(zt[Ze.Symbol.IsAlias]?ja(zt):zt[Ze.Symbol.BaseName])))(dt.field.table)){let zt=ja(dt.field.table);throw new Error(`Your "${dt.path.join("->")}" field references a column "${zt}"."${dt.field.name}", but the table "${zt}" is not part of the query! Did you forget to join it?`)}let z=!m||m.length===0,se=this.buildWithCTE(r),we;O&&(we=O===!0?Y` distinct`:Y` distinct on (${Y.join(O.on,Y`, `)})`);let xe=this.buildSelection(N,{isSingleTable:z}),ye=this.buildFromTable(d),Se=this.buildJoins(m),be=c?Y` where ${c}`:void 0,Oe=u?Y` having ${u}`:void 0,Ue;w&&w.length>0&&(Ue=Y` order by ${Y.join(w,Y`, `)}`);let et;y&&y.length>0&&(et=Y` group by ${Y.join(y,Y`, `)}`);let Ot=typeof g=="object"||typeof g=="number"&&g>=0?Y` limit ${g}`:void 0,Yt=_?Y` offset ${_}`:void 0,Gt=Y.empty();if(S){let dt=Y` for ${Y.raw(S.strength)}`;S.config.of&&dt.append(Y` of ${Y.join(Array.isArray(S.config.of)?S.config.of:[S.config.of],Y`, `)}`),S.config.noWait?dt.append(Y` no wait`):S.config.skipLocked&&dt.append(Y` skip locked`),Gt.append(dt)}let _t=Y`${se}select${we} ${xe} from ${ye}${Se}${be}${et}${Oe}${Ue}${Ot}${Yt}${Gt}`;return H.length>0?this.buildSetOperations(_t,H):_t}buildSetOperations(r,t){let[e,...c]=t;if(!e)throw new Error("Cannot pass undefined values to any set operator");return c.length===0?this.buildSetOperationQuery({leftSelect:r,setOperator:e}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:r,setOperator:e}),c)}buildSetOperationQuery({leftSelect:r,setOperator:{type:t,isAll:e,rightSelect:c,limit:u,orderBy:d,offset:m}}){let w=Y`(${r.getSQL()}) `,y=Y`(${c.getSQL()})`,g;if(d&&d.length>0){let H=[];for(let N of d)if(ge(N,Ve))H.push(Y.identifier(N.name));else if(ge(N,at)){for(let z=0;z<N.queryChunks.length;z++){let se=N.queryChunks[z];ge(se,Ve)&&(N.queryChunks[z]=Y.identifier(se.name))}H.push(Y`${N}`)}else H.push(Y`${N}`);g=Y` order by ${Y.join(H,Y`, `)} `}let _=typeof u=="object"||typeof u=="number"&&u>=0?Y` limit ${u}`:void 0,S=Y.raw(`${t} ${e?"all ":""}`),O=m?Y` offset ${m}`:void 0;return Y`${w}${S}${y}${g}${_}${O}`}buildInsertQuery({table:r,values:t,onConflict:e,returning:c,withList:u,select:d,overridingSystemValue_:m}){let w=[],y=r[Ze.Symbol.Columns],g=Object.entries(y).filter(([se,we])=>!we.shouldDisableInsert()),_=g.map(([,se])=>Y.identifier(this.casing.getColumnCasing(se)));if(d){let se=t;ge(se,at)?w.push(se):w.push(se.getSQL())}else{let se=t;w.push(Y.raw("values "));for(let[we,xe]of se.entries()){let ye=[];for(let[Se,be]of g){let Oe=xe[Se];if(Oe===void 0||ge(Oe,qa)&&Oe.value===void 0)if(be.defaultFn!==void 0){let Ue=be.defaultFn(),et=ge(Ue,at)?Ue:Y.param(Ue,be);ye.push(et)}else if(!be.default&&be.onUpdateFn!==void 0){let Ue=be.onUpdateFn(),et=ge(Ue,at)?Ue:Y.param(Ue,be);ye.push(et)}else ye.push(Y`default`);else ye.push(Oe)}w.push(ye),we<se.length-1&&w.push(Y`, `)}}let S=this.buildWithCTE(u),O=Y.join(w),H=c?Y` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,N=e?Y` on conflict ${e}`:void 0,z=m===!0?Y`overriding system value `:void 0;return Y`${S}insert into ${r} ${_} ${z}${O}${N}${H}`}buildRefreshMaterializedViewQuery({view:r,concurrently:t,withNoData:e}){let c=t?Y` concurrently`:void 0,u=e?Y` with no data`:void 0;return Y`refresh materialized view${c} ${r}${u}`}prepareTyping(r){return ge(r,xu)||ge(r,mu)?"json":ge(r,vu)?"decimal":ge(r,gu)?"time":ge(r,yu)||ge(r,bu)?"timestamp":ge(r,du)||ge(r,hu)?"date":ge(r,wu)?"uuid":"none"}sqlToQuery(r,t){return r.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:r,schema:t,tableNamesMap:e,table:c,tableConfig:u,queryConfig:d,tableAlias:m,nestedQueryRelation:w,joinOn:y}){let g=[],_,S,O=[],H,N=[];if(d===!0)g=Object.entries(u.columns).map(([we,xe])=>({dbKey:xe.name,tsKey:we,field:Kn(xe,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let se=Object.fromEntries(Object.entries(u.columns).map(([Oe,Ue])=>[Oe,Kn(Ue,m)]));if(d.where){let Oe=typeof d.where=="function"?d.where(se,Z5()):d.where;H=Oe&&lu(Oe,m)}let we=[],xe=[];if(d.columns){let Oe=!1;for(let[Ue,et]of Object.entries(d.columns))et!==void 0&&Ue in u.columns&&(!Oe&&et===!0&&(Oe=!0),xe.push(Ue));xe.length>0&&(xe=Oe?xe.filter(Ue=>d.columns?.[Ue]===!0):Object.keys(u.columns).filter(Ue=>!xe.includes(Ue)))}else xe=Object.keys(u.columns);for(let Oe of xe){let Ue=u.columns[Oe];we.push({tsKey:Oe,value:Ue})}let ye=[];d.with&&(ye=Object.entries(d.with).filter(Oe=>!!Oe[1]).map(([Oe,Ue])=>({tsKey:Oe,queryConfig:Ue,relation:u.relations[Oe]})));let Se;if(d.extras){Se=typeof d.extras=="function"?d.extras(se,{sql:Y}):d.extras;for(let[Oe,Ue]of Object.entries(Se))we.push({tsKey:Oe,value:Hv(Ue,m)})}for(let{tsKey:Oe,value:Ue}of we)g.push({dbKey:ge(Ue,at.Aliased)?Ue.fieldAlias:u.columns[Oe].name,tsKey:Oe,field:ge(Ue,Qt)?Kn(Ue,m):Ue,relationTableTsKey:void 0,isJson:!1,selection:[]});let be=typeof d.orderBy=="function"?d.orderBy(se,J5()):d.orderBy??[];Array.isArray(be)||(be=[be]),O=be.map(Oe=>ge(Oe,Qt)?Kn(Oe,m):lu(Oe,m)),_=d.limit,S=d.offset;for(let{tsKey:Oe,queryConfig:Ue,relation:et}of ye){let Ot=t9(t,e,et),Yt=Hs(et.referencedTable),Gt=e[Yt],_t=`${m}_${Oe}`,dt=_u(...Ot.fields.map((Je,Te)=>mc(Kn(Ot.references[Te],_t),Kn(Je,m)))),zt=this.buildRelationalQueryWithoutPK({fullSchema:r,schema:t,tableNamesMap:e,table:r[Gt],tableConfig:t[Gt],queryConfig:ge(et,Zi)?Ue===!0?{limit:1}:{...Ue,limit:1}:Ue,tableAlias:_t,joinOn:dt,nestedQueryRelation:et}),mt=Y`${Y.identifier(_t)}.${Y.identifier("data")}`.as(Oe);N.push({on:Y`true`,table:new jr(zt.sql,{},_t),alias:_t,joinType:"left",lateral:!0}),g.push({dbKey:Oe,tsKey:Oe,field:mt,relationTableTsKey:Gt,isJson:!0,selection:zt.selection})}}if(g.length===0)throw new pu({message:`No fields selected for table "${u.tsName}" ("${m}")`});let z;if(H=_u(y,H),w){let se=Y`json_build_array(${Y.join(g.map(({field:ye,tsKey:Se,isJson:be})=>be?Y`${Y.identifier(`${m}_${Se}`)}.${Y.identifier("data")}`:ge(ye,at.Aliased)?ye.sql:ye),Y`, `)})`;ge(w,Fu)&&(se=Y`coalesce(json_agg(${se}${O.length>0?Y` order by ${Y.join(O,Y`, `)}`:void 0}), '[]'::json)`);let we=[{dbKey:"data",tsKey:"data",field:se.as("data"),isJson:!0,relationTableTsKey:u.tsName,selection:g}];_!==void 0||S!==void 0||O.length>0?(z=this.buildSelectQuery({table:cu(c,m),fields:{},fieldsFlat:[{path:[],field:Y.raw("*")}],where:H,limit:_,offset:S,orderBy:O,setOperators:[]}),H=void 0,_=void 0,S=void 0,O=[]):z=cu(c,m),z=this.buildSelectQuery({table:ge(z,ra)?z:new jr(z,{},m),fields:{},fieldsFlat:we.map(({field:ye})=>({path:[],field:ge(ye,Qt)?Kn(ye,m):ye})),joins:N,where:H,limit:_,offset:S,orderBy:O,setOperators:[]})}else z=this.buildSelectQuery({table:cu(c,m),fields:{},fieldsFlat:g.map(({field:se})=>({path:[],field:ge(se,Qt)?Kn(se,m):se})),joins:N,where:H,limit:_,offset:S,orderBy:O,setOperators:[]});return{tableTsKey:u.tsName,sql:z,selection:g}}};var I0=class{static[Q]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var va=class{static[Q]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(r){this.fields=r.fields,this.session=r.session,this.dialect=r.dialect,r.withList&&(this.withList=r.withList),this.distinct=r.distinct}authToken;setToken(r){return this.authToken=r,this}from(r){let t=!!this.fields,e=r,c;return this.fields?c=this.fields:ge(e,jr)?c=Object.fromEntries(Object.keys(e._.selectedFields).map(u=>[u,e[u]])):ge(e,xc)?c=e[sr].selectedFields:ge(e,at)?c={}:c=E0(e),new N0({table:e,fields:c,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},u2=class extends I0{static[Q]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:r,fields:t,isPartialSelect:e,session:c,dialect:u,withList:d,distinct:m}){super(),this.config={withList:d,table:r,fields:{...t},distinct:m,setOperators:[]},this.isPartialSelect=e,this.session=c,this.dialect=u,this._={selectedFields:t},this.tableName=gi(r),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(r){return(t,e)=>{let c=this.tableName,u=gi(t);if(typeof u=="string"&&this.config.joins?.some(d=>d.alias===u))throw new Error(`Alias "${u}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof c=="string"&&(this.config.fields={[c]:this.config.fields}),typeof u=="string"&&!ge(t,at))){let d=ge(t,jr)?t._.selectedFields:ge(t,Ca)?t[sr].selectedFields:t[Ze.Symbol.Columns];this.config.fields[u]=d}if(typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:e,table:t,joinType:r,alias:u}),typeof u=="string")switch(r){case"left":{this.joinsNotNullableMap[u]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([d])=>[d,!1])),this.joinsNotNullableMap[u]=!0;break}case"inner":{this.joinsNotNullableMap[u]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([d])=>[d,!1])),this.joinsNotNullableMap[u]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(r,t){return e=>{let c=typeof e=="function"?e(jne()):e;if(!uu(this.getSelectedFields(),c.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:r,isAll:t,rightSelect:c}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(r){return this.config.setOperators.push(...r),this}where(r){return typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=r,this}having(r){return typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=r,this}groupBy(...r){if(typeof r[0]=="function"){let t=r[0](new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=r;return this}orderBy(...r){if(typeof r[0]=="function"){let t=r[0](new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),e=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e}else{let t=r;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(r){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=r:this.config.limit=r,this}offset(r){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=r:this.config.offset=r,this}for(r,t={}){return this.config.lockingClause={strength:r,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(r){return new Proxy(new jr(this.getSQL(),this.config.fields,r),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Cr({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},N0=class extends u2{static[Q]="PgSelect";_prepare(r){let{session:t,config:e,dialect:c,joinsNotNullableMap:u,authToken:d}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ir.startActiveSpan("drizzle.prepareQuery",()=>{let m=bn(e.fields),w=t.prepareQuery(c.sqlToQuery(this.getSQL()),m,r,!0);return w.joinsNotNullableMap=u,w.setToken(d)})}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken))};XA(N0,[xa]);function vc(a,r){return(t,e,...c)=>{let u=[e,...c].map(d=>({type:a,isAll:r,rightSelect:d}));for(let d of u)if(!uu(t.getSelectedFields(),d.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(u)}}var jne=()=>({union:qne,unionAll:Une,intersect:zne,intersectAll:$ne,except:Hne,exceptAll:Vne}),qne=vc("union",!1),Une=vc("union",!0),zne=vc("intersect",!1),$ne=vc("intersect",!0),Hne=vc("except",!1),Vne=vc("except",!0);var gc=class{static[Q]="PgQueryBuilder";dialect;dialectConfig;constructor(r){this.dialect=ge(r,Ji)?r:void 0,this.dialectConfig=ge(r,Ji)?void 0:r}$with=(r,t)=>{let e=this;return{as:u=>(typeof u=="function"&&(u=u(e)),new Proxy(new pc(u.getSQL(),t??("getSelectedFields"in u?u.getSelectedFields()??{}:{}),r,!0),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...r){let t=this;function e(d){return new va({fields:d??void 0,session:void 0,dialect:t.getDialect(),withList:r})}function c(d){return new va({fields:d??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function u(d,m){return new va({fields:m??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:d}})}return{select:e,selectDistinct:c,selectDistinctOn:u}}select(r){return new va({fields:r??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(r){return new va({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(r,t){return new va({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:r}})}getDialect(){return this.dialect||(this.dialect=new Ji(this.dialectConfig)),this.dialect}};var Eu=class{constructor(r,t,e,c,u){this.table=r,this.session=t,this.dialect=e,this.withList=c,this.overridingSystemValue_=u}static[Q]="PgInsertBuilder";authToken;setToken(r){return this.authToken=r,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(r){if(r=Array.isArray(r)?r:[r],r.length===0)throw new Error("values() must be called with at least one value");let t=r.map(e=>{let c={},u=this.table[Ze.Symbol.Columns];for(let d of Object.keys(e)){let m=e[d];c[d]=ge(m,at)?m:new qa(m,u[d])}return c});return new R0(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(r){let t=typeof r=="function"?r(new gc):r;if(!ge(t,at)&&!uu(this.table[_0],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new R0(this.table,t,this.session,this.dialect,this.withList,!0)}},R0=class extends xa{constructor(r,t,e,c,u,d,m){super(),this.session=e,this.dialect=c,this.config={table:r,values:t,withList:u,select:d,overridingSystemValue_:m}}static[Q]="PgInsert";config;returning(r=this.config.table[Ze.Symbol.Columns]){return this.config.returningFields=r,this.config.returning=bn(r),this}onConflictDoNothing(r={}){if(r.target===void 0)this.config.onConflict=Y`do nothing`;else{let t="";t=Array.isArray(r.target)?r.target.map(c=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(c))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(r.target));let e=r.where?Y` where ${r.where}`:void 0;this.config.onConflict=Y`(${Y.raw(t)})${e} do nothing`}return this}onConflictDoUpdate(r){if(r.where&&(r.targetWhere||r.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=r.where?Y` where ${r.where}`:void 0,e=r.targetWhere?Y` where ${r.targetWhere}`:void 0,c=r.setWhere?Y` where ${r.setWhere}`:void 0,u=this.dialect.buildUpdateSet(this.config.table,F0(this.config.table,r.set)),d="";return d=Array.isArray(r.target)?r.target.map(m=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(m))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(r.target)),this.config.onConflict=Y`(${Y.raw(d)})${e} do update set ${u}${t}${c}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,r,!0))}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Cr({alias:ja(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var L0=class extends xa{constructor(r,t,e){super(),this.session=t,this.dialect=e,this.config={view:r}}static[Q]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,r,!0))}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken))};var Su=class{constructor(r,t,e,c){this.table=r,this.session=t,this.dialect=e,this.withList=c}static[Q]="PgUpdateBuilder";authToken;setToken(r){return this.authToken=r,this}set(r){return new f2(this.table,F0(this.table,r),this.session,this.dialect,this.withList).setToken(this.authToken)}},f2=class extends xa{constructor(r,t,e,c,u){super(),this.session=e,this.dialect=c,this.config={set:t,table:r,withList:u,joins:[]},this.tableName=gi(r),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[Q]="PgUpdate";config;tableName;joinsNotNullableMap;from(r){let t=r,e=gi(t);return typeof e=="string"&&(this.joinsNotNullableMap[e]=!0),this.config.from=t,this}getTableLikeFields(r){return ge(r,ra)?r[Ze.Symbol.Columns]:ge(r,jr)?r._.selectedFields:r[sr].selectedFields}createJoin(r){return(t,e)=>{let c=gi(t);if(typeof c=="string"&&this.config.joins.some(u=>u.alias===c))throw new Error(`Alias "${c}" is already used in this query`);if(typeof e=="function"){let u=this.config.from&&!ge(this.config.from,at)?this.getTableLikeFields(this.config.from):void 0;e=e(new Proxy(this.config.table[Ze.Symbol.Columns],new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),u&&new Proxy(u,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:e,table:t,joinType:r,alias:c}),typeof c=="string")switch(r){case"left":{this.joinsNotNullableMap[c]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[c]=!0;break}case"inner":{this.joinsNotNullableMap[c]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[c]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(r){return this.config.where=r,this}returning(r){if(!r&&(r=Object.assign({},this.config.table[Ze.Symbol.Columns]),this.config.from)){let t=gi(this.config.from);if(typeof t=="string"&&this.config.from&&!ge(this.config.from,at)){let e=this.getTableLikeFields(this.config.from);r[t]=e}for(let e of this.config.joins){let c=gi(e.table);if(typeof c=="string"&&!ge(e.table,at)){let u=this.getTableLikeFields(e.table);r[c]=u}}}return this.config.returningFields=r,this.config.returning=bn(r),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,r,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>this._prepare().execute(r,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Cr({alias:ja(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var M0=class a extends at{constructor(r){super(a.buildEmbeddedCount(r.source,r.filters).queryChunks),this.params=r,this.mapWith(Number),this.session=r.session,this.sql=a.buildCount(r.source,r.filters)}sql;token;static[Q]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(r,t){return Y`(select count(*) from ${r}${Y.raw(" where ").if(t)}${t})`}static buildCount(r,t){return Y`select count(*) as count from ${r}${Y.raw(" where ").if(t)}${t};`}setToken(r){return this.token=r,this}then(r,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(r,t)}catch(r){return this.then(void 0,r)}finally(r){return this.then(t=>(r?.(),t),t=>{throw r?.(),t})}};var B0=class{constructor(r,t,e,c,u,d,m){this.fullSchema=r,this.schema=t,this.tableNamesMap=e,this.table=c,this.tableConfig=u,this.dialect=d,this.session=m}static[Q]="PgRelationalQueryBuilder";findMany(r){return new j0(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,r||{},"many")}findFirst(r){return new j0(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,r?{...r,limit:1}:{limit:1},"first")}},j0=class extends xa{constructor(r,t,e,c,u,d,m,w,y){super(),this.fullSchema=r,this.schema=t,this.tableNamesMap=e,this.table=c,this.tableConfig=u,this.dialect=d,this.session=m,this.config=w,this.mode=y}static[Q]="PgRelationalQuery";_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:e}=this._toSQL();return this.session.prepareQuery(e,void 0,r,!0,(c,u)=>{let d=c.map(m=>P0(this.schema,this.tableConfig,m,t.selection,u));return this.mode==="first"?d[0]:d})})}prepare(r){return this._prepare(r)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let r=this._getQuery(),t=this.dialect.sqlToQuery(r.sql);return{query:r,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(r){return this.authToken=r,this}execute(){return ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var q0=class extends xa{constructor(r,t,e,c){super(),this.execute=r,this.sql=t,this.query=e,this.mapBatchResult=c}static[Q]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(r,t){return t?this.mapBatchResult(r):r}_prepare(){return this}isResponseInArrayMode(){return!1}};var yc=class{constructor(r,t,e){if(this.dialect=r,this.session=t,this._=e?{schema:e.schema,fullSchema:e.fullSchema,tableNamesMap:e.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[c,u]of Object.entries(this._.schema))this.query[c]=new B0(e.fullSchema,this._.schema,this._.tableNamesMap,e.fullSchema[c],u,r,t)}static[Q]="PgDatabase";query;$with=(r,t)=>{let e=this;return{as:u=>(typeof u=="function"&&(u=u(new gc(e.dialect))),new Proxy(new pc(u.getSQL(),t??("getSelectedFields"in u?u.getSelectedFields()??{}:{}),r,!0),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(r,t){return new M0({source:r,filters:t,session:this.session})}with(...r){let t=this;function e(y){return new va({fields:y??void 0,session:t.session,dialect:t.dialect,withList:r})}function c(y){return new va({fields:y??void 0,session:t.session,dialect:t.dialect,withList:r,distinct:!0})}function u(y,g){return new va({fields:g??void 0,session:t.session,dialect:t.dialect,withList:r,distinct:{on:y}})}function d(y){return new Su(y,t.session,t.dialect,r)}function m(y){return new Eu(y,t.session,t.dialect,r)}function w(y){return new fu(y,t.session,t.dialect,r)}return{select:e,selectDistinct:c,selectDistinctOn:u,update:d,insert:m,delete:w}}select(r){return new va({fields:r??void 0,session:this.session,dialect:this.dialect})}selectDistinct(r){return new va({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(r,t){return new va({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:r}})}update(r){return new Su(r,this.session,this.dialect)}insert(r){return new Eu(r,this.session,this.dialect)}delete(r){return new fu(r,this.session,this.dialect)}refreshMaterializedView(r){return new L0(r,this.session,this.dialect)}authToken;execute(r){let t=typeof r=="string"?Y.raw(r):r.getSQL(),e=this.dialect.sqlToQuery(t),c=this.session.prepareQuery(e,void 0,void 0,!1);return new q0(()=>c.execute(void 0,this.authToken),t,e,u=>c.mapResult(u,!0))}transaction(r,t){return this.session.transaction(r,t)}};var U0=class{constructor(r){this.query=r}authToken;getQuery(){return this.query}mapResult(r,t){return r}setToken(r){return this.authToken=r,this}static[Q]="PgPreparedQuery";joinsNotNullableMap},z0=class{constructor(r){this.dialect=r}static[Q]="PgSession";execute(r,t){return ir.startActiveSpan("drizzle.operation",()=>ir.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(r),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(r){return this.prepareQuery(this.dialect.sqlToQuery(r),void 0,void 0,!1).all()}async count(r,t){let e=await this.execute(r,t);return Number(e[0].count)}},$0=class extends yc{constructor(r,t,e,c=0){super(r,t,e),this.schema=e,this.nestedIndex=c}static[Q]="PgTransaction";rollback(){throw new C0}getTransactionConfigSQL(r){let t=[];return r.isolationLevel&&t.push(`isolation level ${r.isolationLevel}`),r.accessMode&&t.push(r.accessMode),typeof r.deferrable=="boolean"&&t.push(r.deferrable?"deferrable":"not deferrable"),Y.raw(t.join(" "))}setTransaction(r){return this.session.execute(Y`set transaction ${this.getTransactionConfigSQL(r)}`)}};var{Pool:a9,types:Yn}=Yi,p2=class extends U0{constructor(r,t,e,c,u,d,m,w){super({sql:t,params:e}),this.client=r,this.params=e,this.logger=c,this.fields=u,this._isResponseInArrayMode=m,this.customResultMapper=w,this.rawQueryConfig={name:d,text:t,types:{getTypeParser:(y,g)=>y===Yn.builtins.TIMESTAMPTZ?_=>_:y===Yn.builtins.TIMESTAMP?_=>_:y===Yn.builtins.DATE?_=>_:y===Yn.builtins.INTERVAL?_=>_:Yn.getTypeParser(y,g)}},this.queryConfig={name:d,text:t,rowMode:"array",types:{getTypeParser:(y,g)=>y===Yn.builtins.TIMESTAMPTZ?_=>_:y===Yn.builtins.TIMESTAMP?_=>_:y===Yn.builtins.DATE?_=>_:y===Yn.builtins.INTERVAL?_=>_:Yn.getTypeParser(y,g)}}}static[Q]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(r={}){return ir.startActiveSpan("drizzle.execute",async()=>{let t=$v(this.params,r);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:e,rawQueryConfig:c,client:u,queryConfig:d,joinsNotNullableMap:m,customResultMapper:w}=this;if(!e&&!w)return ir.startActiveSpan("drizzle.driver.execute",async g=>(g?.setAttributes({"drizzle.query.name":c.name,"drizzle.query.text":c.text,"drizzle.query.params":JSON.stringify(t)}),u.query(c,t)));let y=await ir.startActiveSpan("drizzle.driver.execute",g=>(g?.setAttributes({"drizzle.query.name":d.name,"drizzle.query.text":d.text,"drizzle.query.params":JSON.stringify(t)}),u.query(d,t)));return ir.startActiveSpan("drizzle.mapResponse",()=>w?w(y.rows):y.rows.map(g=>KA(e,g,m)))})}all(r={}){return ir.startActiveSpan("drizzle.execute",()=>{let t=$v(this.params,r);return this.logger.logQuery(this.rawQueryConfig.text,t),ir.startActiveSpan("drizzle.driver.execute",e=>(e?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.client.query(this.rawQueryConfig,t).then(c=>c.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},H0=class a extends z0{constructor(r,t,e,c={}){super(t),this.client=r,this.schema=e,this.options=c,this.logger=c.logger??new v0}static[Q]="NodePgSession";logger;prepareQuery(r,t,e,c,u){return new p2(this.client,r.sql,r.params,this.logger,t,e,c,u)}async transaction(r,t){let e=this.client instanceof a9?new a(await this.client.connect(),this.dialect,this.schema,this.options):this,c=new d2(this.dialect,e,this.schema);await c.execute(Y`begin${t?Y` ${c.getTransactionConfigSQL(t)}`:void 0}`);try{let u=await r(c);return await c.execute(Y`commit`),u}catch(u){throw await c.execute(Y`rollback`),u}finally{this.client instanceof a9&&e.client.release()}}async count(r){let t=await this.execute(r);return Number(t.rows[0].count)}},d2=class a extends $0{static[Q]="NodePgTransaction";async transaction(r){let t=`sp${this.nestedIndex+1}`,e=new a(this.dialect,this.session,this.schema,this.nestedIndex+1);await e.execute(Y.raw(`savepoint ${t}`));try{let c=await r(e);return await e.execute(Y.raw(`release savepoint ${t}`)),c}catch(c){throw await e.execute(Y.raw(`rollback to savepoint ${t}`)),c}}};var h2=class{constructor(r,t,e={}){this.client=r,this.dialect=t,this.options=e}static[Q]="NodePgDriver";createSession(r){return new H0(this.client,this.dialect,r,{logger:this.options.logger})}},m2=class extends yc{static[Q]="NodePgDatabase"};function Cu(a,r={}){let t=new Ji({casing:r.casing}),e;r.logger===!0?e=new x0:r.logger!==!1&&(e=r.logger);let c;if(r.schema){let w=e9(r.schema,r9);c={fullSchema:r.schema,schema:w.tables,tableNamesMap:w.tableNamesMap}}let d=new h2(a,t,{logger:e}).createSession(c),m=new m2(t,d,c);return m.$client=a,m}function V0(...a){if(typeof a[0]=="string"){let r=new Yi.Pool({connectionString:a[0]});return Cu(r,a[1])}if(ZA(a[0])){let{connection:r,client:t,...e}=a[0];if(t)return Cu(t,e);let c=typeof r=="string"?new Yi.Pool({connectionString:r}):new Yi.Pool(r);return Cu(c,e)}return Cu(a[0],a[1])}(a=>{function r(t){return Cu({},t)}a.mock=r})(V0||(V0={}));var w2={};Zw(w2,{insertProcessedFileSchema:()=>cse,processedFiles:()=>Tc});var $t;(function(a){a.assertEqual=c=>c;function r(c){}a.assertIs=r;function t(c){throw new Error}a.assertNever=t,a.arrayToEnum=c=>{let u={};for(let d of c)u[d]=d;return u},a.getValidEnumValues=c=>{let u=a.objectKeys(c).filter(m=>typeof c[c[m]]!="number"),d={};for(let m of u)d[m]=c[m];return a.objectValues(d)},a.objectValues=c=>a.objectKeys(c).map(function(u){return c[u]}),a.objectKeys=typeof Object.keys=="function"?c=>Object.keys(c):c=>{let u=[];for(let d in c)Object.prototype.hasOwnProperty.call(c,d)&&u.push(d);return u},a.find=(c,u)=>{for(let d of c)if(u(d))return d},a.isInteger=typeof Number.isInteger=="function"?c=>Number.isInteger(c):c=>typeof c=="number"&&isFinite(c)&&Math.floor(c)===c;function e(c,u=" | "){return c.map(d=>typeof d=="string"?`'${d}'`:d).join(u)}a.joinValues=e,a.jsonStringifyReplacer=(c,u)=>typeof u=="bigint"?u.toString():u})($t||($t={}));var v2;(function(a){a.mergeShapes=(r,t)=>({...r,...t})})(v2||(v2={}));var rt=$t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wi=a=>{switch(typeof a){case"undefined":return rt.undefined;case"string":return rt.string;case"number":return isNaN(a)?rt.nan:rt.number;case"boolean":return rt.boolean;case"function":return rt.function;case"bigint":return rt.bigint;case"symbol":return rt.symbol;case"object":return Array.isArray(a)?rt.array:a===null?rt.null:a.then&&typeof a.then=="function"&&a.catch&&typeof a.catch=="function"?rt.promise:typeof Map<"u"&&a instanceof Map?rt.map:typeof Set<"u"&&a instanceof Set?rt.set:typeof Date<"u"&&a instanceof Date?rt.date:rt.object;default:return rt.unknown}},Ie=$t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Wne=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:"),Za=class a extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=r}format(r){let t=r||function(u){return u.message},e={_errors:[]},c=u=>{for(let d of u.issues)if(d.code==="invalid_union")d.unionErrors.map(c);else if(d.code==="invalid_return_type")c(d.returnTypeError);else if(d.code==="invalid_arguments")c(d.argumentsError);else if(d.path.length===0)e._errors.push(t(d));else{let m=e,w=0;for(;w<d.path.length;){let y=d.path[w];w===d.path.length-1?(m[y]=m[y]||{_errors:[]},m[y]._errors.push(t(d))):m[y]=m[y]||{_errors:[]},m=m[y],w++}}};return c(this),e}static assert(r){if(!(r instanceof a))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,$t.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=t=>t.message){let t={},e=[];for(let c of this.issues)c.path.length>0?(t[c.path[0]]=t[c.path[0]]||[],t[c.path[0]].push(r(c))):e.push(r(c));return{formErrors:e,fieldErrors:t}}get formErrors(){return this.flatten()}};Za.create=a=>new Za(a);var _c=(a,r)=>{let t;switch(a.code){case Ie.invalid_type:a.received===rt.undefined?t="Required":t=`Expected ${a.expected}, received ${a.received}`;break;case Ie.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(a.expected,$t.jsonStringifyReplacer)}`;break;case Ie.unrecognized_keys:t=`Unrecognized key(s) in object: ${$t.joinValues(a.keys,", ")}`;break;case Ie.invalid_union:t="Invalid input";break;case Ie.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${$t.joinValues(a.options)}`;break;case Ie.invalid_enum_value:t=`Invalid enum value. Expected ${$t.joinValues(a.options)}, received '${a.received}'`;break;case Ie.invalid_arguments:t="Invalid function arguments";break;case Ie.invalid_return_type:t="Invalid function return type";break;case Ie.invalid_date:t="Invalid date";break;case Ie.invalid_string:typeof a.validation=="object"?"includes"in a.validation?(t=`Invalid input: must include "${a.validation.includes}"`,typeof a.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?t=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?t=`Invalid input: must end with "${a.validation.endsWith}"`:$t.assertNever(a.validation):a.validation!=="regex"?t=`Invalid ${a.validation}`:t="Invalid";break;case Ie.too_small:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:t="Invalid input";break;case Ie.too_big:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="bigint"?t=`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:t="Invalid input";break;case Ie.custom:t="Invalid input";break;case Ie.invalid_intersection_types:t="Intersection results could not be merged";break;case Ie.not_multiple_of:t=`Number must be a multiple of ${a.multipleOf}`;break;case Ie.not_finite:t="Number must be finite";break;default:t=r.defaultError,$t.assertNever(a)}return{message:t}},o9=_c;function Gne(a){o9=a}function W0(){return o9}var G0=a=>{let{data:r,path:t,errorMaps:e,issueData:c}=a,u=[...t,...c.path||[]],d={...c,path:u};if(c.message!==void 0)return{...c,path:u,message:c.message};let m="",w=e.filter(y=>!!y).slice().reverse();for(let y of w)m=y(d,{data:r,defaultError:m}).message;return{...c,path:u,message:m}},Qne=[];function Xe(a,r){let t=W0(),e=G0({issueData:r,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,t,t===_c?void 0:_c].filter(c=>!!c)});a.common.issues.push(e)}var ga=class a{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,t){let e=[];for(let c of t){if(c.status==="aborted")return bt;c.status==="dirty"&&r.dirty(),e.push(c.value)}return{status:r.value,value:e}}static async mergeObjectAsync(r,t){let e=[];for(let c of t){let u=await c.key,d=await c.value;e.push({key:u,value:d})}return a.mergeObjectSync(r,e)}static mergeObjectSync(r,t){let e={};for(let c of t){let{key:u,value:d}=c;if(u.status==="aborted"||d.status==="aborted")return bt;u.status==="dirty"&&r.dirty(),d.status==="dirty"&&r.dirty(),u.value!=="__proto__"&&(typeof d.value<"u"||c.alwaysSet)&&(e[u.value]=d.value)}return{status:r.value,value:e}}},bt=Object.freeze({status:"aborted"}),wc=a=>({status:"dirty",value:a}),ka=a=>({status:"valid",value:a}),g2=a=>a.status==="aborted",y2=a=>a.status==="dirty",Ws=a=>a.status==="valid",Au=a=>typeof Promise<"u"&&a instanceof Promise;function Q0(a,r,t,e){if(t==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?a!==r||!e:!r.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?e:t==="a"?e.call(a):e?e.value:r.get(a)}function c9(a,r,t,e,c){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?a!==r||!c:!r.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?c.call(a,t):c?c.value=t:r.set(a,t),t}var ct;(function(a){a.errToObj=r=>typeof r=="string"?{message:r}:r||{},a.toString=r=>typeof r=="string"?r:r?.message})(ct||(ct={}));var ku,Tu,_n=class{constructor(r,t,e,c){this._cachedPath=[],this.parent=r,this.data=t,this._path=e,this._key=c}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},n9=(a,r)=>{if(Ws(r))return{success:!0,data:r.value};if(!a.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Za(a.common.issues);return this._error=t,this._error}}};function Tt(a){if(!a)return{};let{errorMap:r,invalid_type_error:t,required_error:e,description:c}=a;if(r&&(t||e))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:c}:{errorMap:(d,m)=>{var w,y;let{message:g}=a;return d.code==="invalid_enum_value"?{message:g??m.defaultError}:typeof m.data>"u"?{message:(w=g??e)!==null&&w!==void 0?w:m.defaultError}:d.code!=="invalid_type"?{message:m.defaultError}:{message:(y=g??t)!==null&&y!==void 0?y:m.defaultError}},description:c}}var At=class{get description(){return this._def.description}_getType(r){return wi(r.data)}_getOrReturnCtx(r,t){return t||{common:r.parent.common,data:r.data,parsedType:wi(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new ga,ctx:{common:r.parent.common,data:r.data,parsedType:wi(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){let t=this._parse(r);if(Au(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(r){let t=this._parse(r);return Promise.resolve(t)}parse(r,t){let e=this.safeParse(r,t);if(e.success)return e.data;throw e.error}safeParse(r,t){var e;let c={common:{issues:[],async:(e=t?.async)!==null&&e!==void 0?e:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)},u=this._parseSync({data:r,path:c.path,parent:c});return n9(c,u)}"~validate"(r){var t,e;let c={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)};if(!this["~standard"].async)try{let u=this._parseSync({data:r,path:[],parent:c});return Ws(u)?{value:u.value}:{issues:c.common.issues}}catch(u){!((e=(t=u?.message)===null||t===void 0?void 0:t.toLowerCase())===null||e===void 0)&&e.includes("encountered")&&(this["~standard"].async=!0),c.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:c}).then(u=>Ws(u)?{value:u.value}:{issues:c.common.issues})}async parseAsync(r,t){let e=await this.safeParseAsync(r,t);if(e.success)return e.data;throw e.error}async safeParseAsync(r,t){let e={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)},c=this._parse({data:r,path:e.path,parent:e}),u=await(Au(c)?c:Promise.resolve(c));return n9(e,u)}refine(r,t){let e=c=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(c):t;return this._refinement((c,u)=>{let d=r(c),m=()=>u.addIssue({code:Ie.custom,...e(c)});return typeof Promise<"u"&&d instanceof Promise?d.then(w=>w?!0:(m(),!1)):d?!0:(m(),!1)})}refinement(r,t){return this._refinement((e,c)=>r(e)?!0:(c.addIssue(typeof t=="function"?t(e,c):t),!1))}_refinement(r){return new Ja({schema:this,typeName:vt.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return wn.create(this,this._def)}nullable(){return Jn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Fi.create(this)}promise(){return rs.create(this,this._def)}or(r){return Js.create([this,r],this._def)}and(r){return eo.create(this,r,this._def)}transform(r){return new Ja({...Tt(this._def),schema:this,typeName:vt.ZodEffects,effect:{type:"transform",transform:r}})}default(r){let t=typeof r=="function"?r:()=>r;return new io({...Tt(this._def),innerType:this,defaultValue:t,typeName:vt.ZodDefault})}brand(){return new Du({typeName:vt.ZodBranded,type:this,...Tt(this._def)})}catch(r){let t=typeof r=="function"?r:()=>r;return new so({...Tt(this._def),innerType:this,catchValue:t,typeName:vt.ZodCatch})}describe(r){let t=this.constructor;return new t({...this._def,description:r})}pipe(r){return Ou.create(this,r)}readonly(){return oo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Kne=/^c[^\s-]{8,}$/i,Xne=/^[0-9a-z]+$/,Yne=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Zne=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Jne=/^[a-z0-9_-]{21}$/i,eie=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tie=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rie=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aie="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",x2,nie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,oie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cie=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,lie=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,l9="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uie=new RegExp(`^${l9}$`);function u9(a){let r="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return a.precision?r=`${r}\\.\\d{${a.precision}}`:a.precision==null&&(r=`${r}(\\.\\d+)?`),r}function fie(a){return new RegExp(`^${u9(a)}$`)}function f9(a){let r=`${l9}T${u9(a)}`,t=[];return t.push(a.local?"Z?":"Z"),a.offset&&t.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${t.join("|")})`,new RegExp(`^${r}$`)}function pie(a,r){return!!((r==="v4"||!r)&&nie.test(a)||(r==="v6"||!r)&&sie.test(a))}function die(a,r){if(!eie.test(a))return!1;try{let[t]=a.split("."),e=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),c=JSON.parse(atob(e));return!(typeof c!="object"||c===null||!c.typ||!c.alg||r&&c.alg!==r)}catch{return!1}}function hie(a,r){return!!((r==="v4"||!r)&&iie.test(a)||(r==="v6"||!r)&&oie.test(a))}var es=class a extends At{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==rt.string){let u=this._getOrReturnCtx(r);return Xe(u,{code:Ie.invalid_type,expected:rt.string,received:u.parsedType}),bt}let e=new ga,c;for(let u of this._def.checks)if(u.kind==="min")r.data.length<u.value&&(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),e.dirty());else if(u.kind==="max")r.data.length>u.value&&(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),e.dirty());else if(u.kind==="length"){let d=r.data.length>u.value,m=r.data.length<u.value;(d||m)&&(c=this._getOrReturnCtx(r,c),d?Xe(c,{code:Ie.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):m&&Xe(c,{code:Ie.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),e.dirty())}else if(u.kind==="email")rie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"email",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="emoji")x2||(x2=new RegExp(aie,"u")),x2.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"emoji",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="uuid")Zne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"uuid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="nanoid")Jne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"nanoid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="cuid")Kne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cuid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="cuid2")Xne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cuid2",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="ulid")Yne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"ulid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="url")try{new URL(r.data)}catch{c=this._getOrReturnCtx(r,c),Xe(c,{validation:"url",code:Ie.invalid_string,message:u.message}),e.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"regex",code:Ie.invalid_string,message:u.message}),e.dirty())):u.kind==="trim"?r.data=r.data.trim():u.kind==="includes"?r.data.includes(u.value,u.position)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),e.dirty()):u.kind==="toLowerCase"?r.data=r.data.toLowerCase():u.kind==="toUpperCase"?r.data=r.data.toUpperCase():u.kind==="startsWith"?r.data.startsWith(u.value)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{startsWith:u.value},message:u.message}),e.dirty()):u.kind==="endsWith"?r.data.endsWith(u.value)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{endsWith:u.value},message:u.message}),e.dirty()):u.kind==="datetime"?f9(u).test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"datetime",message:u.message}),e.dirty()):u.kind==="date"?uie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"date",message:u.message}),e.dirty()):u.kind==="time"?fie(u).test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"time",message:u.message}),e.dirty()):u.kind==="duration"?tie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"duration",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="ip"?pie(r.data,u.version)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"ip",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="jwt"?die(r.data,u.alg)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"jwt",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="cidr"?hie(r.data,u.version)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cidr",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="base64"?cie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"base64",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="base64url"?lie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"base64url",code:Ie.invalid_string,message:u.message}),e.dirty()):$t.assertNever(u);return{status:e.value,value:r.data}}_regex(r,t,e){return this.refinement(c=>r.test(c),{validation:t,code:Ie.invalid_string,...ct.errToObj(e)})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...ct.errToObj(r)})}url(r){return this._addCheck({kind:"url",...ct.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...ct.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...ct.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...ct.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...ct.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...ct.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...ct.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...ct.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...ct.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...ct.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...ct.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...ct.errToObj(r)})}datetime(r){var t,e;return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof r?.precision>"u"?null:r?.precision,offset:(t=r?.offset)!==null&&t!==void 0?t:!1,local:(e=r?.local)!==null&&e!==void 0?e:!1,...ct.errToObj(r?.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof r?.precision>"u"?null:r?.precision,...ct.errToObj(r?.message)})}duration(r){return this._addCheck({kind:"duration",...ct.errToObj(r)})}regex(r,t){return this._addCheck({kind:"regex",regex:r,...ct.errToObj(t)})}includes(r,t){return this._addCheck({kind:"includes",value:r,position:t?.position,...ct.errToObj(t?.message)})}startsWith(r,t){return this._addCheck({kind:"startsWith",value:r,...ct.errToObj(t)})}endsWith(r,t){return this._addCheck({kind:"endsWith",value:r,...ct.errToObj(t)})}min(r,t){return this._addCheck({kind:"min",value:r,...ct.errToObj(t)})}max(r,t){return this._addCheck({kind:"max",value:r,...ct.errToObj(t)})}length(r,t){return this._addCheck({kind:"length",value:r,...ct.errToObj(t)})}nonempty(r){return this.min(1,ct.errToObj(r))}trim(){return new a({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(let t of this._def.checks)t.kind==="min"&&(r===null||t.value>r)&&(r=t.value);return r}get maxLength(){let r=null;for(let t of this._def.checks)t.kind==="max"&&(r===null||t.value<r)&&(r=t.value);return r}};es.create=a=>{var r;return new es({checks:[],typeName:vt.ZodString,coerce:(r=a?.coerce)!==null&&r!==void 0?r:!1,...Tt(a)})};function mie(a,r){let t=(a.toString().split(".")[1]||"").length,e=(r.toString().split(".")[1]||"").length,c=t>e?t:e,u=parseInt(a.toFixed(c).replace(".","")),d=parseInt(r.toFixed(c).replace(".",""));return u%d/Math.pow(10,c)}var Gs=class a extends At{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==rt.number){let u=this._getOrReturnCtx(r);return Xe(u,{code:Ie.invalid_type,expected:rt.number,received:u.parsedType}),bt}let e,c=new ga;for(let u of this._def.checks)u.kind==="int"?$t.isInteger(r.data)||(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.invalid_type,expected:"integer",received:"float",message:u.message}),c.dirty()):u.kind==="min"?(u.inclusive?r.data<u.value:r.data<=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),c.dirty()):u.kind==="max"?(u.inclusive?r.data>u.value:r.data>=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),c.dirty()):u.kind==="multipleOf"?mie(r.data,u.value)!==0&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_multiple_of,multipleOf:u.value,message:u.message}),c.dirty()):u.kind==="finite"?Number.isFinite(r.data)||(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_finite,message:u.message}),c.dirty()):$t.assertNever(u);return{status:c.value,value:r.data}}gte(r,t){return this.setLimit("min",r,!0,ct.toString(t))}gt(r,t){return this.setLimit("min",r,!1,ct.toString(t))}lte(r,t){return this.setLimit("max",r,!0,ct.toString(t))}lt(r,t){return this.setLimit("max",r,!1,ct.toString(t))}setLimit(r,t,e,c){return new a({...this._def,checks:[...this._def.checks,{kind:r,value:t,inclusive:e,message:ct.toString(c)}]})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:ct.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ct.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ct.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ct.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ct.toString(r)})}multipleOf(r,t){return this._addCheck({kind:"multipleOf",value:r,message:ct.toString(t)})}finite(r){return this._addCheck({kind:"finite",message:ct.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ct.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ct.toString(r)})}get minValue(){let r=null;for(let t of this._def.checks)t.kind==="min"&&(r===null||t.value>r)&&(r=t.value);return r}get maxValue(){let r=null;for(let t of this._def.checks)t.kind==="max"&&(r===null||t.value<r)&&(r=t.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&$t.isInteger(r.value))}get isFinite(){let r=null,t=null;for(let e of this._def.checks){if(e.kind==="finite"||e.kind==="int"||e.kind==="multipleOf")return!0;e.kind==="min"?(t===null||e.value>t)&&(t=e.value):e.kind==="max"&&(r===null||e.value<r)&&(r=e.value)}return Number.isFinite(t)&&Number.isFinite(r)}};Gs.create=a=>new Gs({checks:[],typeName:vt.ZodNumber,coerce:a?.coerce||!1,...Tt(a)});var Qs=class a extends At{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==rt.bigint)return this._getInvalidInput(r);let e,c=new ga;for(let u of this._def.checks)u.kind==="min"?(u.inclusive?r.data<u.value:r.data<=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),c.dirty()):u.kind==="max"?(u.inclusive?r.data>u.value:r.data>=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),c.dirty()):u.kind==="multipleOf"?r.data%u.value!==BigInt(0)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_multiple_of,multipleOf:u.value,message:u.message}),c.dirty()):$t.assertNever(u);return{status:c.value,value:r.data}}_getInvalidInput(r){let t=this._getOrReturnCtx(r);return Xe(t,{code:Ie.invalid_type,expected:rt.bigint,received:t.parsedType}),bt}gte(r,t){return this.setLimit("min",r,!0,ct.toString(t))}gt(r,t){return this.setLimit("min",r,!1,ct.toString(t))}lte(r,t){return this.setLimit("max",r,!0,ct.toString(t))}lt(r,t){return this.setLimit("max",r,!1,ct.toString(t))}setLimit(r,t,e,c){return new a({...this._def,checks:[...this._def.checks,{kind:r,value:t,inclusive:e,message:ct.toString(c)}]})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ct.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),incl
		`;await t.execute(Y`CREATE SCHEMA IF NOT EXISTS ${Y.identifier(u)}`),await t.execute(d);let w=(await t.all(Y`select id, hash, created_at from ${Y.identifier(u)}.${Y.identifier(c)} order by created_at desc limit 1`))[0];await t.transaction(async y=>{for await(let g of r)if(!w||Number(w.created_at)<g.folderMillis){for(let _ of g.sql)await y.execute(Y.raw(_));await y.execute(Y`insert into ${Y.identifier(u)}.${Y.identifier(c)} ("hash", "created_at") values(${g.hash}, ${g.folderMillis})`)}})}escapeName(r){return`"${r}"`}escapeParam(r){return`$${r+1}`}escapeString(r){return`'${r.replace(/'/g,"''")}'`}buildWithCTE(r){if(!r?.length)return;let t=[Y`with `];for(let[e,c]of r.entries())t.push(Y`${Y.identifier(c._.alias)} as (${c._.sql})`),e<r.length-1&&t.push(Y`, `);return t.push(Y` `),Y.join(t)}buildDeleteQuery({table:r,where:t,returning:e,withList:c}){let u=this.buildWithCTE(c),d=e?Y` returning ${this.buildSelection(e,{isSingleTable:!0})}`:void 0,m=t?Y` where ${t}`:void 0;return Y`${u}delete from ${r}${m}${d}`}buildUpdateSet(r,t){let e=r[Ze.Symbol.Columns],c=Object.keys(e).filter(d=>t[d]!==void 0||e[d]?.onUpdateFn!==void 0),u=c.length;return Y.join(c.flatMap((d,m)=>{let w=e[d],y=t[d]??Y.param(w.onUpdateFn(),w),g=Y`${Y.identifier(this.casing.getColumnCasing(w))} = ${y}`;return m<u-1?[g,Y.raw(", ")]:[g]}))}buildUpdateQuery({table:r,set:t,where:e,returning:c,withList:u,from:d,joins:m}){let w=this.buildWithCTE(u),y=r[ra.Symbol.Name],g=r[ra.Symbol.Schema],_=r[ra.Symbol.OriginalName],S=y===_?void 0:y,O=Y`${g?Y`${Y.identifier(g)}.`:void 0}${Y.identifier(_)}${S&&Y` ${Y.identifier(S)}`}`,H=this.buildUpdateSet(r,t),N=d&&Y.join([Y.raw(" from "),this.buildFromTable(d)]),z=this.buildJoins(m),se=c?Y` returning ${this.buildSelection(c,{isSingleTable:!d})}`:void 0,we=e?Y` where ${e}`:void 0;return Y`${w}update ${O} set ${H}${N}${z}${we}${se}`}buildSelection(r,{isSingleTable:t=!1}={}){let e=r.length,c=r.flatMap(({field:u},d)=>{let m=[];if(ge(u,at.Aliased)&&u.isSelectionField)m.push(Y.identifier(u.fieldAlias));else if(ge(u,at.Aliased)||ge(u,at)){let w=ge(u,at.Aliased)?u.sql:u;t?m.push(new at(w.queryChunks.map(y=>ge(y,Ve)?Y.identifier(this.casing.getColumnCasing(y)):y))):m.push(w),ge(u,at.Aliased)&&m.push(Y` as ${Y.identifier(u.fieldAlias)}`)}else ge(u,Qt)&&(t?m.push(Y.identifier(this.casing.getColumnCasing(u))):m.push(u));return d<e-1&&m.push(Y`, `),m});return Y.join(c)}buildJoins(r){if(!r||r.length===0)return;let t=[];for(let[e,c]of r.entries()){e===0&&t.push(Y` `);let u=c.table,d=c.lateral?Y` lateral`:void 0;if(ge(u,ra)){let m=u[ra.Symbol.Name],w=u[ra.Symbol.Schema],y=u[ra.Symbol.OriginalName],g=m===y?void 0:c.alias;t.push(Y`${Y.raw(c.joinType)} join${d} ${w?Y`${Y.identifier(w)}.`:void 0}${Y.identifier(y)}${g&&Y` ${Y.identifier(g)}`} on ${c.on}`)}else if(ge(u,Ca)){let m=u[sr].name,w=u[sr].schema,y=u[sr].originalName,g=m===y?void 0:c.alias;t.push(Y`${Y.raw(c.joinType)} join${d} ${w?Y`${Y.identifier(w)}.`:void 0}${Y.identifier(y)}${g&&Y` ${Y.identifier(g)}`} on ${c.on}`)}else t.push(Y`${Y.raw(c.joinType)} join${d} ${u} on ${c.on}`);e<r.length-1&&t.push(Y` `)}return Y.join(t)}buildFromTable(r){if(ge(r,Ze)&&r[Ze.Symbol.OriginalName]!==r[Ze.Symbol.Name]){let t=Y`${Y.identifier(r[Ze.Symbol.OriginalName])}`;return r[Ze.Symbol.Schema]&&(t=Y`${Y.identifier(r[Ze.Symbol.Schema])}.${t}`),Y`${t} ${Y.identifier(r[Ze.Symbol.Name])}`}return r}buildSelectQuery({withList:r,fields:t,fieldsFlat:e,where:c,having:u,table:d,joins:m,orderBy:w,groupBy:y,limit:g,offset:_,lockingClause:S,distinct:O,setOperators:H}){let N=e??bn(t);for(let dt of N)if(ge(dt.field,Qt)&&ja(dt.field.table)!==(ge(d,jr)?d._.alias:ge(d,xc)?d[sr].name:ge(d,at)?void 0:ja(d))&&!(zt=>m?.some(({alias:mt})=>mt===(zt[Ze.Symbol.IsAlias]?ja(zt):zt[Ze.Symbol.BaseName])))(dt.field.table)){let zt=ja(dt.field.table);throw new Error(`Your "${dt.path.join("->")}" field references a column "${zt}"."${dt.field.name}", but the table "${zt}" is not part of the query! Did you forget to join it?`)}let z=!m||m.length===0,se=this.buildWithCTE(r),we;O&&(we=O===!0?Y` distinct`:Y` distinct on (${Y.join(O.on,Y`, `)})`);let xe=this.buildSelection(N,{isSingleTable:z}),ye=this.buildFromTable(d),Se=this.buildJoins(m),be=c?Y` where ${c}`:void 0,Oe=u?Y` having ${u}`:void 0,Ue;w&&w.length>0&&(Ue=Y` order by ${Y.join(w,Y`, `)}`);let et;y&&y.length>0&&(et=Y` group by ${Y.join(y,Y`, `)}`);let Ot=typeof g=="object"||typeof g=="number"&&g>=0?Y` limit ${g}`:void 0,Yt=_?Y` offset ${_}`:void 0,Gt=Y.empty();if(S){let dt=Y` for ${Y.raw(S.strength)}`;S.config.of&&dt.append(Y` of ${Y.join(Array.isArray(S.config.of)?S.config.of:[S.config.of],Y`, `)}`),S.config.noWait?dt.append(Y` no wait`):S.config.skipLocked&&dt.append(Y` skip locked`),Gt.append(dt)}let _t=Y`${se}select${we} ${xe} from ${ye}${Se}${be}${et}${Oe}${Ue}${Ot}${Yt}${Gt}`;return H.length>0?this.buildSetOperations(_t,H):_t}buildSetOperations(r,t){let[e,...c]=t;if(!e)throw new Error("Cannot pass undefined values to any set operator");return c.length===0?this.buildSetOperationQuery({leftSelect:r,setOperator:e}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:r,setOperator:e}),c)}buildSetOperationQuery({leftSelect:r,setOperator:{type:t,isAll:e,rightSelect:c,limit:u,orderBy:d,offset:m}}){let w=Y`(${r.getSQL()}) `,y=Y`(${c.getSQL()})`,g;if(d&&d.length>0){let H=[];for(let N of d)if(ge(N,Ve))H.push(Y.identifier(N.name));else if(ge(N,at)){for(let z=0;z<N.queryChunks.length;z++){let se=N.queryChunks[z];ge(se,Ve)&&(N.queryChunks[z]=Y.identifier(se.name))}H.push(Y`${N}`)}else H.push(Y`${N}`);g=Y` order by ${Y.join(H,Y`, `)} `}let _=typeof u=="object"||typeof u=="number"&&u>=0?Y` limit ${u}`:void 0,S=Y.raw(`${t} ${e?"all ":""}`),O=m?Y` offset ${m}`:void 0;return Y`${w}${S}${y}${g}${_}${O}`}buildInsertQuery({table:r,values:t,onConflict:e,returning:c,withList:u,select:d,overridingSystemValue_:m}){let w=[],y=r[Ze.Symbol.Columns],g=Object.entries(y).filter(([se,we])=>!we.shouldDisableInsert()),_=g.map(([,se])=>Y.identifier(this.casing.getColumnCasing(se)));if(d){let se=t;ge(se,at)?w.push(se):w.push(se.getSQL())}else{let se=t;w.push(Y.raw("values "));for(let[we,xe]of se.entries()){let ye=[];for(let[Se,be]of g){let Oe=xe[Se];if(Oe===void 0||ge(Oe,qa)&&Oe.value===void 0)if(be.defaultFn!==void 0){let Ue=be.defaultFn(),et=ge(Ue,at)?Ue:Y.param(Ue,be);ye.push(et)}else if(!be.default&&be.onUpdateFn!==void 0){let Ue=be.onUpdateFn(),et=ge(Ue,at)?Ue:Y.param(Ue,be);ye.push(et)}else ye.push(Y`default`);else ye.push(Oe)}w.push(ye),we<se.length-1&&w.push(Y`, `)}}let S=this.buildWithCTE(u),O=Y.join(w),H=c?Y` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,N=e?Y` on conflict ${e}`:void 0,z=m===!0?Y`overriding system value `:void 0;return Y`${S}insert into ${r} ${_} ${z}${O}${N}${H}`}buildRefreshMaterializedViewQuery({view:r,concurrently:t,withNoData:e}){let c=t?Y` concurrently`:void 0,u=e?Y` with no data`:void 0;return Y`refresh materialized view${c} ${r}${u}`}prepareTyping(r){return ge(r,xu)||ge(r,mu)?"json":ge(r,vu)?"decimal":ge(r,gu)?"time":ge(r,yu)||ge(r,bu)?"timestamp":ge(r,du)||ge(r,hu)?"date":ge(r,wu)?"uuid":"none"}sqlToQuery(r,t){return r.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:r,schema:t,tableNamesMap:e,table:c,tableConfig:u,queryConfig:d,tableAlias:m,nestedQueryRelation:w,joinOn:y}){let g=[],_,S,O=[],H,N=[];if(d===!0)g=Object.entries(u.columns).map(([we,xe])=>({dbKey:xe.name,tsKey:we,field:Kn(xe,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let se=Object.fromEntries(Object.entries(u.columns).map(([Oe,Ue])=>[Oe,Kn(Ue,m)]));if(d.where){let Oe=typeof d.where=="function"?d.where(se,Z5()):d.where;H=Oe&&lu(Oe,m)}let we=[],xe=[];if(d.columns){let Oe=!1;for(let[Ue,et]of Object.entries(d.columns))et!==void 0&&Ue in u.columns&&(!Oe&&et===!0&&(Oe=!0),xe.push(Ue));xe.length>0&&(xe=Oe?xe.filter(Ue=>d.columns?.[Ue]===!0):Object.keys(u.columns).filter(Ue=>!xe.includes(Ue)))}else xe=Object.keys(u.columns);for(let Oe of xe){let Ue=u.columns[Oe];we.push({tsKey:Oe,value:Ue})}let ye=[];d.with&&(ye=Object.entries(d.with).filter(Oe=>!!Oe[1]).map(([Oe,Ue])=>({tsKey:Oe,queryConfig:Ue,relation:u.relations[Oe]})));let Se;if(d.extras){Se=typeof d.extras=="function"?d.extras(se,{sql:Y}):d.extras;for(let[Oe,Ue]of Object.entries(Se))we.push({tsKey:Oe,value:Hv(Ue,m)})}for(let{tsKey:Oe,value:Ue}of we)g.push({dbKey:ge(Ue,at.Aliased)?Ue.fieldAlias:u.columns[Oe].name,tsKey:Oe,field:ge(Ue,Qt)?Kn(Ue,m):Ue,relationTableTsKey:void 0,isJson:!1,selection:[]});let be=typeof d.orderBy=="function"?d.orderBy(se,J5()):d.orderBy??[];Array.isArray(be)||(be=[be]),O=be.map(Oe=>ge(Oe,Qt)?Kn(Oe,m):lu(Oe,m)),_=d.limit,S=d.offset;for(let{tsKey:Oe,queryConfig:Ue,relation:et}of ye){let Ot=t9(t,e,et),Yt=Hs(et.referencedTable),Gt=e[Yt],_t=`${m}_${Oe}`,dt=_u(...Ot.fields.map((Je,Te)=>mc(Kn(Ot.references[Te],_t),Kn(Je,m)))),zt=this.buildRelationalQueryWithoutPK({fullSchema:r,schema:t,tableNamesMap:e,table:r[Gt],tableConfig:t[Gt],queryConfig:ge(et,Zi)?Ue===!0?{limit:1}:{...Ue,limit:1}:Ue,tableAlias:_t,joinOn:dt,nestedQueryRelation:et}),mt=Y`${Y.identifier(_t)}.${Y.identifier("data")}`.as(Oe);N.push({on:Y`true`,table:new jr(zt.sql,{},_t),alias:_t,joinType:"left",lateral:!0}),g.push({dbKey:Oe,tsKey:Oe,field:mt,relationTableTsKey:Gt,isJson:!0,selection:zt.selection})}}if(g.length===0)throw new pu({message:`No fields selected for table "${u.tsName}" ("${m}")`});let z;if(H=_u(y,H),w){let se=Y`json_build_array(${Y.join(g.map(({field:ye,tsKey:Se,isJson:be})=>be?Y`${Y.identifier(`${m}_${Se}`)}.${Y.identifier("data")}`:ge(ye,at.Aliased)?ye.sql:ye),Y`, `)})`;ge(w,Fu)&&(se=Y`coalesce(json_agg(${se}${O.length>0?Y` order by ${Y.join(O,Y`, `)}`:void 0}), '[]'::json)`);let we=[{dbKey:"data",tsKey:"data",field:se.as("data"),isJson:!0,relationTableTsKey:u.tsName,selection:g}];_!==void 0||S!==void 0||O.length>0?(z=this.buildSelectQuery({table:cu(c,m),fields:{},fieldsFlat:[{path:[],field:Y.raw("*")}],where:H,limit:_,offset:S,orderBy:O,setOperators:[]}),H=void 0,_=void 0,S=void 0,O=[]):z=cu(c,m),z=this.buildSelectQuery({table:ge(z,ra)?z:new jr(z,{},m),fields:{},fieldsFlat:we.map(({field:ye})=>({path:[],field:ge(ye,Qt)?Kn(ye,m):ye})),joins:N,where:H,limit:_,offset:S,orderBy:O,setOperators:[]})}else z=this.buildSelectQuery({table:cu(c,m),fields:{},fieldsFlat:g.map(({field:se})=>({path:[],field:ge(se,Qt)?Kn(se,m):se})),joins:N,where:H,limit:_,offset:S,orderBy:O,setOperators:[]});return{tableTsKey:u.tsName,sql:z,selection:g}}};var I0=class{static[Q]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var va=class{static[Q]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(r){this.fields=r.fields,this.session=r.session,this.dialect=r.dialect,r.withList&&(this.withList=r.withList),this.distinct=r.distinct}authToken;setToken(r){return this.authToken=r,this}from(r){let t=!!this.fields,e=r,c;return this.fields?c=this.fields:ge(e,jr)?c=Object.fromEntries(Object.keys(e._.selectedFields).map(u=>[u,e[u]])):ge(e,xc)?c=e[sr].selectedFields:ge(e,at)?c={}:c=E0(e),new N0({table:e,fields:c,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},u2=class extends I0{static[Q]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:r,fields:t,isPartialSelect:e,session:c,dialect:u,withList:d,distinct:m}){super(),this.config={withList:d,table:r,fields:{...t},distinct:m,setOperators:[]},this.isPartialSelect=e,this.session=c,this.dialect=u,this._={selectedFields:t},this.tableName=gi(r),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(r){return(t,e)=>{let c=this.tableName,u=gi(t);if(typeof u=="string"&&this.config.joins?.some(d=>d.alias===u))throw new Error(`Alias "${u}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof c=="string"&&(this.config.fields={[c]:this.config.fields}),typeof u=="string"&&!ge(t,at))){let d=ge(t,jr)?t._.selectedFields:ge(t,Ca)?t[sr].selectedFields:t[Ze.Symbol.Columns];this.config.fields[u]=d}if(typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:e,table:t,joinType:r,alias:u}),typeof u=="string")switch(r){case"left":{this.joinsNotNullableMap[u]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([d])=>[d,!1])),this.joinsNotNullableMap[u]=!0;break}case"inner":{this.joinsNotNullableMap[u]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([d])=>[d,!1])),this.joinsNotNullableMap[u]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(r,t){return e=>{let c=typeof e=="function"?e(jne()):e;if(!uu(this.getSelectedFields(),c.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:r,isAll:t,rightSelect:c}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(r){return this.config.setOperators.push(...r),this}where(r){return typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=r,this}having(r){return typeof r=="function"&&(r=r(new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=r,this}groupBy(...r){if(typeof r[0]=="function"){let t=r[0](new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=r;return this}orderBy(...r){if(typeof r[0]=="function"){let t=r[0](new Proxy(this.config.fields,new Cr({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),e=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e}else{let t=r;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(r){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=r:this.config.limit=r,this}offset(r){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=r:this.config.offset=r,this}for(r,t={}){return this.config.lockingClause={strength:r,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(r){return new Proxy(new jr(this.getSQL(),this.config.fields,r),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Cr({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},N0=class extends u2{static[Q]="PgSelect";_prepare(r){let{session:t,config:e,dialect:c,joinsNotNullableMap:u,authToken:d}=this;if(!t)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ir.startActiveSpan("drizzle.prepareQuery",()=>{let m=bn(e.fields),w=t.prepareQuery(c.sqlToQuery(this.getSQL()),m,r,!0);return w.joinsNotNullableMap=u,w.setToken(d)})}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken))};XA(N0,[xa]);function vc(a,r){return(t,e,...c)=>{let u=[e,...c].map(d=>({type:a,isAll:r,rightSelect:d}));for(let d of u)if(!uu(t.getSelectedFields(),d.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(u)}}var jne=()=>({union:qne,unionAll:Une,intersect:zne,intersectAll:$ne,except:Hne,exceptAll:Vne}),qne=vc("union",!1),Une=vc("union",!0),zne=vc("intersect",!1),$ne=vc("intersect",!0),Hne=vc("except",!1),Vne=vc("except",!0);var gc=class{static[Q]="PgQueryBuilder";dialect;dialectConfig;constructor(r){this.dialect=ge(r,Ji)?r:void 0,this.dialectConfig=ge(r,Ji)?void 0:r}$with=(r,t)=>{let e=this;return{as:u=>(typeof u=="function"&&(u=u(e)),new Proxy(new pc(u.getSQL(),t??("getSelectedFields"in u?u.getSelectedFields()??{}:{}),r,!0),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...r){let t=this;function e(d){return new va({fields:d??void 0,session:void 0,dialect:t.getDialect(),withList:r})}function c(d){return new va({fields:d??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})}function u(d,m){return new va({fields:m??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:d}})}return{select:e,selectDistinct:c,selectDistinctOn:u}}select(r){return new va({fields:r??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(r){return new va({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(r,t){return new va({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:r}})}getDialect(){return this.dialect||(this.dialect=new Ji(this.dialectConfig)),this.dialect}};var Eu=class{constructor(r,t,e,c,u){this.table=r,this.session=t,this.dialect=e,this.withList=c,this.overridingSystemValue_=u}static[Q]="PgInsertBuilder";authToken;setToken(r){return this.authToken=r,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(r){if(r=Array.isArray(r)?r:[r],r.length===0)throw new Error("values() must be called with at least one value");let t=r.map(e=>{let c={},u=this.table[Ze.Symbol.Columns];for(let d of Object.keys(e)){let m=e[d];c[d]=ge(m,at)?m:new qa(m,u[d])}return c});return new R0(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(r){let t=typeof r=="function"?r(new gc):r;if(!ge(t,at)&&!uu(this.table[_0],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new R0(this.table,t,this.session,this.dialect,this.withList,!0)}},R0=class extends xa{constructor(r,t,e,c,u,d,m){super(),this.session=e,this.dialect=c,this.config={table:r,values:t,withList:u,select:d,overridingSystemValue_:m}}static[Q]="PgInsert";config;returning(r=this.config.table[Ze.Symbol.Columns]){return this.config.returningFields=r,this.config.returning=bn(r),this}onConflictDoNothing(r={}){if(r.target===void 0)this.config.onConflict=Y`do nothing`;else{let t="";t=Array.isArray(r.target)?r.target.map(c=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(c))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(r.target));let e=r.where?Y` where ${r.where}`:void 0;this.config.onConflict=Y`(${Y.raw(t)})${e} do nothing`}return this}onConflictDoUpdate(r){if(r.where&&(r.targetWhere||r.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=r.where?Y` where ${r.where}`:void 0,e=r.targetWhere?Y` where ${r.targetWhere}`:void 0,c=r.setWhere?Y` where ${r.setWhere}`:void 0,u=this.dialect.buildUpdateSet(this.config.table,F0(this.config.table,r.set)),d="";return d=Array.isArray(r.target)?r.target.map(m=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(m))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(r.target)),this.config.onConflict=Y`(${Y.raw(d)})${e} do update set ${u}${t}${c}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,r,!0))}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Cr({alias:ja(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var L0=class extends xa{constructor(r,t,e){super(),this.session=t,this.dialect=e,this.config={view:r}}static[Q]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,r,!0))}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(r,this.authToken))};var Su=class{constructor(r,t,e,c){this.table=r,this.session=t,this.dialect=e,this.withList=c}static[Q]="PgUpdateBuilder";authToken;setToken(r){return this.authToken=r,this}set(r){return new f2(this.table,F0(this.table,r),this.session,this.dialect,this.withList).setToken(this.authToken)}},f2=class extends xa{constructor(r,t,e,c,u){super(),this.session=e,this.dialect=c,this.config={set:t,table:r,withList:u,joins:[]},this.tableName=gi(r),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[Q]="PgUpdate";config;tableName;joinsNotNullableMap;from(r){let t=r,e=gi(t);return typeof e=="string"&&(this.joinsNotNullableMap[e]=!0),this.config.from=t,this}getTableLikeFields(r){return ge(r,ra)?r[Ze.Symbol.Columns]:ge(r,jr)?r._.selectedFields:r[sr].selectedFields}createJoin(r){return(t,e)=>{let c=gi(t);if(typeof c=="string"&&this.config.joins.some(u=>u.alias===c))throw new Error(`Alias "${c}" is already used in this query`);if(typeof e=="function"){let u=this.config.from&&!ge(this.config.from,at)?this.getTableLikeFields(this.config.from):void 0;e=e(new Proxy(this.config.table[Ze.Symbol.Columns],new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),u&&new Proxy(u,new Cr({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:e,table:t,joinType:r,alias:c}),typeof c=="string")switch(r){case"left":{this.joinsNotNullableMap[c]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[c]=!0;break}case"inner":{this.joinsNotNullableMap[c]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([u])=>[u,!1])),this.joinsNotNullableMap[c]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(r){return this.config.where=r,this}returning(r){if(!r&&(r=Object.assign({},this.config.table[Ze.Symbol.Columns]),this.config.from)){let t=gi(this.config.from);if(typeof t=="string"&&this.config.from&&!ge(this.config.from,at)){let e=this.getTableLikeFields(this.config.from);r[t]=e}for(let e of this.config.joins){let c=gi(e.table);if(typeof c=="string"&&!ge(e.table,at)){let u=this.getTableLikeFields(e.table);r[c]=u}}}return this.config.returningFields=r,this.config.returning=bn(r),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:r,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(r){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,r,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(r){return this._prepare(r)}authToken;setToken(r){return this.authToken=r,this}execute=r=>this._prepare().execute(r,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Cr({alias:ja(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var M0=class a extends at{constructor(r){super(a.buildEmbeddedCount(r.source,r.filters).queryChunks),this.params=r,this.mapWith(Number),this.session=r.session,this.sql=a.buildCount(r.source,r.filters)}sql;token;static[Q]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(r,t){return Y`(select count(*) from ${r}${Y.raw(" where ").if(t)}${t})`}static buildCount(r,t){return Y`select count(*) as count from ${r}${Y.raw(" where ").if(t)}${t};`}setToken(r){return this.token=r,this}then(r,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(r,t)}catch(r){return this.then(void 0,r)}finally(r){return this.then(t=>(r?.(),t),t=>{throw r?.(),t})}};var B0=class{constructor(r,t,e,c,u,d,m){this.fullSchema=r,this.schema=t,this.tableNamesMap=e,this.table=c,this.tableConfig=u,this.dialect=d,this.session=m}static[Q]="PgRelationalQueryBuilder";findMany(r){return new j0(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,r||{},"many")}findFirst(r){return new j0(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,r?{...r,limit:1}:{limit:1},"first")}},j0=class extends xa{constructor(r,t,e,c,u,d,m,w,y){super(),this.fullSchema=r,this.schema=t,this.tableNamesMap=e,this.table=c,this.tableConfig=u,this.dialect=d,this.session=m,this.config=w,this.mode=y}static[Q]="PgRelationalQuery";_prepare(r){return ir.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:e}=this._toSQL();return this.session.prepareQuery(e,void 0,r,!0,(c,u)=>{let d=c.map(m=>P0(this.schema,this.tableConfig,m,t.selection,u));return this.mode==="first"?d[0]:d})})}prepare(r){return this._prepare(r)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let r=this._getQuery(),t=this.dialect.sqlToQuery(r.sql);return{query:r,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(r){return this.authToken=r,this}execute(){return ir.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var q0=class extends xa{constructor(r,t,e,c){super(),this.execute=r,this.sql=t,this.query=e,this.mapBatchResult=c}static[Q]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(r,t){return t?this.mapBatchResult(r):r}_prepare(){return this}isResponseInArrayMode(){return!1}};var yc=class{constructor(r,t,e){if(this.dialect=r,this.session=t,this._=e?{schema:e.schema,fullSchema:e.fullSchema,tableNamesMap:e.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[c,u]of Object.entries(this._.schema))this.query[c]=new B0(e.fullSchema,this._.schema,this._.tableNamesMap,e.fullSchema[c],u,r,t)}static[Q]="PgDatabase";query;$with=(r,t)=>{let e=this;return{as:u=>(typeof u=="function"&&(u=u(new gc(e.dialect))),new Proxy(new pc(u.getSQL(),t??("getSelectedFields"in u?u.getSelectedFields()??{}:{}),r,!0),new Cr({alias:r,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(r,t){return new M0({source:r,filters:t,session:this.session})}with(...r){let t=this;function e(y){return new va({fields:y??void 0,session:t.session,dialect:t.dialect,withList:r})}function c(y){return new va({fields:y??void 0,session:t.session,dialect:t.dialect,withList:r,distinct:!0})}function u(y,g){return new va({fields:g??void 0,session:t.session,dialect:t.dialect,withList:r,distinct:{on:y}})}function d(y){return new Su(y,t.session,t.dialect,r)}function m(y){return new Eu(y,t.session,t.dialect,r)}function w(y){return new fu(y,t.session,t.dialect,r)}return{select:e,selectDistinct:c,selectDistinctOn:u,update:d,insert:m,delete:w}}select(r){return new va({fields:r??void 0,session:this.session,dialect:this.dialect})}selectDistinct(r){return new va({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(r,t){return new va({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:r}})}update(r){return new Su(r,this.session,this.dialect)}insert(r){return new Eu(r,this.session,this.dialect)}delete(r){return new fu(r,this.session,this.dialect)}refreshMaterializedView(r){return new L0(r,this.session,this.dialect)}authToken;execute(r){let t=typeof r=="string"?Y.raw(r):r.getSQL(),e=this.dialect.sqlToQuery(t),c=this.session.prepareQuery(e,void 0,void 0,!1);return new q0(()=>c.execute(void 0,this.authToken),t,e,u=>c.mapResult(u,!0))}transaction(r,t){return this.session.transaction(r,t)}};var U0=class{constructor(r){this.query=r}authToken;getQuery(){return this.query}mapResult(r,t){return r}setToken(r){return this.authToken=r,this}static[Q]="PgPreparedQuery";joinsNotNullableMap},z0=class{constructor(r){this.dialect=r}static[Q]="PgSession";execute(r,t){return ir.startActiveSpan("drizzle.operation",()=>ir.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(r),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(r){return this.prepareQuery(this.dialect.sqlToQuery(r),void 0,void 0,!1).all()}async count(r,t){let e=await this.execute(r,t);return Number(e[0].count)}},$0=class extends yc{constructor(r,t,e,c=0){super(r,t,e),this.schema=e,this.nestedIndex=c}static[Q]="PgTransaction";rollback(){throw new C0}getTransactionConfigSQL(r){let t=[];return r.isolationLevel&&t.push(`isolation level ${r.isolationLevel}`),r.accessMode&&t.push(r.accessMode),typeof r.deferrable=="boolean"&&t.push(r.deferrable?"deferrable":"not deferrable"),Y.raw(t.join(" "))}setTransaction(r){return this.session.execute(Y`set transaction ${this.getTransactionConfigSQL(r)}`)}};var{Pool:a9,types:Yn}=Yi,p2=class extends U0{constructor(r,t,e,c,u,d,m,w){super({sql:t,params:e}),this.client=r,this.params=e,this.logger=c,this.fields=u,this._isResponseInArrayMode=m,this.customResultMapper=w,this.rawQueryConfig={name:d,text:t,types:{getTypeParser:(y,g)=>y===Yn.builtins.TIMESTAMPTZ?_=>_:y===Yn.builtins.TIMESTAMP?_=>_:y===Yn.builtins.DATE?_=>_:y===Yn.builtins.INTERVAL?_=>_:Yn.getTypeParser(y,g)}},this.queryConfig={name:d,text:t,rowMode:"array",types:{getTypeParser:(y,g)=>y===Yn.builtins.TIMESTAMPTZ?_=>_:y===Yn.builtins.TIMESTAMP?_=>_:y===Yn.builtins.DATE?_=>_:y===Yn.builtins.INTERVAL?_=>_:Yn.getTypeParser(y,g)}}}static[Q]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(r={}){return ir.startActiveSpan("drizzle.execute",async()=>{let t=$v(this.params,r);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:e,rawQueryConfig:c,client:u,queryConfig:d,joinsNotNullableMap:m,customResultMapper:w}=this;if(!e&&!w)return ir.startActiveSpan("drizzle.driver.execute",async g=>(g?.setAttributes({"drizzle.query.name":c.name,"drizzle.query.text":c.text,"drizzle.query.params":JSON.stringify(t)}),u.query(c,t)));let y=await ir.startActiveSpan("drizzle.driver.execute",g=>(g?.setAttributes({"drizzle.query.name":d.name,"drizzle.query.text":d.text,"drizzle.query.params":JSON.stringify(t)}),u.query(d,t)));return ir.startActiveSpan("drizzle.mapResponse",()=>w?w(y.rows):y.rows.map(g=>KA(e,g,m)))})}all(r={}){return ir.startActiveSpan("drizzle.execute",()=>{let t=$v(this.params,r);return this.logger.logQuery(this.rawQueryConfig.text,t),ir.startActiveSpan("drizzle.driver.execute",e=>(e?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.client.query(this.rawQueryConfig,t).then(c=>c.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}},H0=class a extends z0{constructor(r,t,e,c={}){super(t),this.client=r,this.schema=e,this.options=c,this.logger=c.logger??new v0}static[Q]="NodePgSession";logger;prepareQuery(r,t,e,c,u){return new p2(this.client,r.sql,r.params,this.logger,t,e,c,u)}async transaction(r,t){let e=this.client instanceof a9?new a(await this.client.connect(),this.dialect,this.schema,this.options):this,c=new d2(this.dialect,e,this.schema);await c.execute(Y`begin${t?Y` ${c.getTransactionConfigSQL(t)}`:void 0}`);try{let u=await r(c);return await c.execute(Y`commit`),u}catch(u){throw await c.execute(Y`rollback`),u}finally{this.client instanceof a9&&e.client.release()}}async count(r){let t=await this.execute(r);return Number(t.rows[0].count)}},d2=class a extends $0{static[Q]="NodePgTransaction";async transaction(r){let t=`sp${this.nestedIndex+1}`,e=new a(this.dialect,this.session,this.schema,this.nestedIndex+1);await e.execute(Y.raw(`savepoint ${t}`));try{let c=await r(e);return await e.execute(Y.raw(`release savepoint ${t}`)),c}catch(c){throw await e.execute(Y.raw(`rollback to savepoint ${t}`)),c}}};var h2=class{constructor(r,t,e={}){this.client=r,this.dialect=t,this.options=e}static[Q]="NodePgDriver";createSession(r){return new H0(this.client,this.dialect,r,{logger:this.options.logger})}},m2=class extends yc{static[Q]="NodePgDatabase"};function Cu(a,r={}){let t=new Ji({casing:r.casing}),e;r.logger===!0?e=new x0:r.logger!==!1&&(e=r.logger);let c;if(r.schema){let w=e9(r.schema,r9);c={fullSchema:r.schema,schema:w.tables,tableNamesMap:w.tableNamesMap}}let d=new h2(a,t,{logger:e}).createSession(c),m=new m2(t,d,c);return m.$client=a,m}function V0(...a){if(typeof a[0]=="string"){let r=new Yi.Pool({connectionString:a[0]});return Cu(r,a[1])}if(ZA(a[0])){let{connection:r,client:t,...e}=a[0];if(t)return Cu(t,e);let c=typeof r=="string"?new Yi.Pool({connectionString:r}):new Yi.Pool(r);return Cu(c,e)}return Cu(a[0],a[1])}(a=>{function r(t){return Cu({},t)}a.mock=r})(V0||(V0={}));var w2={};Zw(w2,{insertProcessedFileSchema:()=>cse,processedFiles:()=>Tc});var $t;(function(a){a.assertEqual=c=>c;function r(c){}a.assertIs=r;function t(c){throw new Error}a.assertNever=t,a.arrayToEnum=c=>{let u={};for(let d of c)u[d]=d;return u},a.getValidEnumValues=c=>{let u=a.objectKeys(c).filter(m=>typeof c[c[m]]!="number"),d={};for(let m of u)d[m]=c[m];return a.objectValues(d)},a.objectValues=c=>a.objectKeys(c).map(function(u){return c[u]}),a.objectKeys=typeof Object.keys=="function"?c=>Object.keys(c):c=>{let u=[];for(let d in c)Object.prototype.hasOwnProperty.call(c,d)&&u.push(d);return u},a.find=(c,u)=>{for(let d of c)if(u(d))return d},a.isInteger=typeof Number.isInteger=="function"?c=>Number.isInteger(c):c=>typeof c=="number"&&isFinite(c)&&Math.floor(c)===c;function e(c,u=" | "){return c.map(d=>typeof d=="string"?`'${d}'`:d).join(u)}a.joinValues=e,a.jsonStringifyReplacer=(c,u)=>typeof u=="bigint"?u.toString():u})($t||($t={}));var v2;(function(a){a.mergeShapes=(r,t)=>({...r,...t})})(v2||(v2={}));var rt=$t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wi=a=>{switch(typeof a){case"undefined":return rt.undefined;case"string":return rt.string;case"number":return isNaN(a)?rt.nan:rt.number;case"boolean":return rt.boolean;case"function":return rt.function;case"bigint":return rt.bigint;case"symbol":return rt.symbol;case"object":return Array.isArray(a)?rt.array:a===null?rt.null:a.then&&typeof a.then=="function"&&a.catch&&typeof a.catch=="function"?rt.promise:typeof Map<"u"&&a instanceof Map?rt.map:typeof Set<"u"&&a instanceof Set?rt.set:typeof Date<"u"&&a instanceof Date?rt.date:rt.object;default:return rt.unknown}},Ie=$t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Wne=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:"),Za=class a extends Error{get errors(){return this.issues}constructor(r){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=r}format(r){let t=r||function(u){return u.message},e={_errors:[]},c=u=>{for(let d of u.issues)if(d.code==="invalid_union")d.unionErrors.map(c);else if(d.code==="invalid_return_type")c(d.returnTypeError);else if(d.code==="invalid_arguments")c(d.argumentsError);else if(d.path.length===0)e._errors.push(t(d));else{let m=e,w=0;for(;w<d.path.length;){let y=d.path[w];w===d.path.length-1?(m[y]=m[y]||{_errors:[]},m[y]._errors.push(t(d))):m[y]=m[y]||{_errors:[]},m=m[y],w++}}};return c(this),e}static assert(r){if(!(r instanceof a))throw new Error(`Not a ZodError: ${r}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,$t.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(r=t=>t.message){let t={},e=[];for(let c of this.issues)c.path.length>0?(t[c.path[0]]=t[c.path[0]]||[],t[c.path[0]].push(r(c))):e.push(r(c));return{formErrors:e,fieldErrors:t}}get formErrors(){return this.flatten()}};Za.create=a=>new Za(a);var _c=(a,r)=>{let t;switch(a.code){case Ie.invalid_type:a.received===rt.undefined?t="Required":t=`Expected ${a.expected}, received ${a.received}`;break;case Ie.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(a.expected,$t.jsonStringifyReplacer)}`;break;case Ie.unrecognized_keys:t=`Unrecognized key(s) in object: ${$t.joinValues(a.keys,", ")}`;break;case Ie.invalid_union:t="Invalid input";break;case Ie.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${$t.joinValues(a.options)}`;break;case Ie.invalid_enum_value:t=`Invalid enum value. Expected ${$t.joinValues(a.options)}, received '${a.received}'`;break;case Ie.invalid_arguments:t="Invalid function arguments";break;case Ie.invalid_return_type:t="Invalid function return type";break;case Ie.invalid_date:t="Invalid date";break;case Ie.invalid_string:typeof a.validation=="object"?"includes"in a.validation?(t=`Invalid input: must include "${a.validation.includes}"`,typeof a.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?t=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?t=`Invalid input: must end with "${a.validation.endsWith}"`:$t.assertNever(a.validation):a.validation!=="regex"?t=`Invalid ${a.validation}`:t="Invalid";break;case Ie.too_small:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:t="Invalid input";break;case Ie.too_big:a.type==="array"?t=`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:a.type==="string"?t=`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:a.type==="number"?t=`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="bigint"?t=`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:a.type==="date"?t=`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:t="Invalid input";break;case Ie.custom:t="Invalid input";break;case Ie.invalid_intersection_types:t="Intersection results could not be merged";break;case Ie.not_multiple_of:t=`Number must be a multiple of ${a.multipleOf}`;break;case Ie.not_finite:t="Number must be finite";break;default:t=r.defaultError,$t.assertNever(a)}return{message:t}},o9=_c;function Gne(a){o9=a}function W0(){return o9}var G0=a=>{let{data:r,path:t,errorMaps:e,issueData:c}=a,u=[...t,...c.path||[]],d={...c,path:u};if(c.message!==void 0)return{...c,path:u,message:c.message};let m="",w=e.filter(y=>!!y).slice().reverse();for(let y of w)m=y(d,{data:r,defaultError:m}).message;return{...c,path:u,message:m}},Qne=[];function Xe(a,r){let t=W0(),e=G0({issueData:r,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,t,t===_c?void 0:_c].filter(c=>!!c)});a.common.issues.push(e)}var ga=class a{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(r,t){let e=[];for(let c of t){if(c.status==="aborted")return bt;c.status==="dirty"&&r.dirty(),e.push(c.value)}return{status:r.value,value:e}}static async mergeObjectAsync(r,t){let e=[];for(let c of t){let u=await c.key,d=await c.value;e.push({key:u,value:d})}return a.mergeObjectSync(r,e)}static mergeObjectSync(r,t){let e={};for(let c of t){let{key:u,value:d}=c;if(u.status==="aborted"||d.status==="aborted")return bt;u.status==="dirty"&&r.dirty(),d.status==="dirty"&&r.dirty(),u.value!=="__proto__"&&(typeof d.value<"u"||c.alwaysSet)&&(e[u.value]=d.value)}return{status:r.value,value:e}}},bt=Object.freeze({status:"aborted"}),wc=a=>({status:"dirty",value:a}),ka=a=>({status:"valid",value:a}),g2=a=>a.status==="aborted",y2=a=>a.status==="dirty",Ws=a=>a.status==="valid",Au=a=>typeof Promise<"u"&&a instanceof Promise;function Q0(a,r,t,e){if(t==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?a!==r||!e:!r.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?e:t==="a"?e.call(a):e?e.value:r.get(a)}function c9(a,r,t,e,c){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!c)throw new TypeError("Private accessor was defined without a setter");if(typeof r=="function"?a!==r||!c:!r.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?c.call(a,t):c?c.value=t:r.set(a,t),t}var ct;(function(a){a.errToObj=r=>typeof r=="string"?{message:r}:r||{},a.toString=r=>typeof r=="string"?r:r?.message})(ct||(ct={}));var ku,Tu,_n=class{constructor(r,t,e,c){this._cachedPath=[],this.parent=r,this.data=t,this._path=e,this._key=c}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},n9=(a,r)=>{if(Ws(r))return{success:!0,data:r.value};if(!a.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Za(a.common.issues);return this._error=t,this._error}}};function Tt(a){if(!a)return{};let{errorMap:r,invalid_type_error:t,required_error:e,description:c}=a;if(r&&(t||e))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return r?{errorMap:r,description:c}:{errorMap:(d,m)=>{var w,y;let{message:g}=a;return d.code==="invalid_enum_value"?{message:g??m.defaultError}:typeof m.data>"u"?{message:(w=g??e)!==null&&w!==void 0?w:m.defaultError}:d.code!=="invalid_type"?{message:m.defaultError}:{message:(y=g??t)!==null&&y!==void 0?y:m.defaultError}},description:c}}var At=class{get description(){return this._def.description}_getType(r){return wi(r.data)}_getOrReturnCtx(r,t){return t||{common:r.parent.common,data:r.data,parsedType:wi(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}_processInputParams(r){return{status:new ga,ctx:{common:r.parent.common,data:r.data,parsedType:wi(r.data),schemaErrorMap:this._def.errorMap,path:r.path,parent:r.parent}}}_parseSync(r){let t=this._parse(r);if(Au(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(r){let t=this._parse(r);return Promise.resolve(t)}parse(r,t){let e=this.safeParse(r,t);if(e.success)return e.data;throw e.error}safeParse(r,t){var e;let c={common:{issues:[],async:(e=t?.async)!==null&&e!==void 0?e:!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)},u=this._parseSync({data:r,path:c.path,parent:c});return n9(c,u)}"~validate"(r){var t,e;let c={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)};if(!this["~standard"].async)try{let u=this._parseSync({data:r,path:[],parent:c});return Ws(u)?{value:u.value}:{issues:c.common.issues}}catch(u){!((e=(t=u?.message)===null||t===void 0?void 0:t.toLowerCase())===null||e===void 0)&&e.includes("encountered")&&(this["~standard"].async=!0),c.common={issues:[],async:!0}}return this._parseAsync({data:r,path:[],parent:c}).then(u=>Ws(u)?{value:u.value}:{issues:c.common.issues})}async parseAsync(r,t){let e=await this.safeParseAsync(r,t);if(e.success)return e.data;throw e.error}async safeParseAsync(r,t){let e={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:r,parsedType:wi(r)},c=this._parse({data:r,path:e.path,parent:e}),u=await(Au(c)?c:Promise.resolve(c));return n9(e,u)}refine(r,t){let e=c=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(c):t;return this._refinement((c,u)=>{let d=r(c),m=()=>u.addIssue({code:Ie.custom,...e(c)});return typeof Promise<"u"&&d instanceof Promise?d.then(w=>w?!0:(m(),!1)):d?!0:(m(),!1)})}refinement(r,t){return this._refinement((e,c)=>r(e)?!0:(c.addIssue(typeof t=="function"?t(e,c):t),!1))}_refinement(r){return new Ja({schema:this,typeName:vt.ZodEffects,effect:{type:"refinement",refinement:r}})}superRefine(r){return this._refinement(r)}constructor(r){this.spa=this.safeParseAsync,this._def=r,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return wn.create(this,this._def)}nullable(){return Jn.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Fi.create(this)}promise(){return rs.create(this,this._def)}or(r){return Js.create([this,r],this._def)}and(r){return eo.create(this,r,this._def)}transform(r){return new Ja({...Tt(this._def),schema:this,typeName:vt.ZodEffects,effect:{type:"transform",transform:r}})}default(r){let t=typeof r=="function"?r:()=>r;return new io({...Tt(this._def),innerType:this,defaultValue:t,typeName:vt.ZodDefault})}brand(){return new Du({typeName:vt.ZodBranded,type:this,...Tt(this._def)})}catch(r){let t=typeof r=="function"?r:()=>r;return new so({...Tt(this._def),innerType:this,catchValue:t,typeName:vt.ZodCatch})}describe(r){let t=this.constructor;return new t({...this._def,description:r})}pipe(r){return Ou.create(this,r)}readonly(){return oo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Kne=/^c[^\s-]{8,}$/i,Xne=/^[0-9a-z]+$/,Yne=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Zne=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Jne=/^[a-z0-9_-]{21}$/i,eie=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,tie=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rie=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aie="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",x2,nie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,iie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,oie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cie=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,lie=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,l9="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",uie=new RegExp(`^${l9}$`);function u9(a){let r="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return a.precision?r=`${r}\\.\\d{${a.precision}}`:a.precision==null&&(r=`${r}(\\.\\d+)?`),r}function fie(a){return new RegExp(`^${u9(a)}$`)}function f9(a){let r=`${l9}T${u9(a)}`,t=[];return t.push(a.local?"Z?":"Z"),a.offset&&t.push("([+-]\\d{2}:?\\d{2})"),r=`${r}(${t.join("|")})`,new RegExp(`^${r}$`)}function pie(a,r){return!!((r==="v4"||!r)&&nie.test(a)||(r==="v6"||!r)&&sie.test(a))}function die(a,r){if(!eie.test(a))return!1;try{let[t]=a.split("."),e=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),c=JSON.parse(atob(e));return!(typeof c!="object"||c===null||!c.typ||!c.alg||r&&c.alg!==r)}catch{return!1}}function hie(a,r){return!!((r==="v4"||!r)&&iie.test(a)||(r==="v6"||!r)&&oie.test(a))}var es=class a extends At{_parse(r){if(this._def.coerce&&(r.data=String(r.data)),this._getType(r)!==rt.string){let u=this._getOrReturnCtx(r);return Xe(u,{code:Ie.invalid_type,expected:rt.string,received:u.parsedType}),bt}let e=new ga,c;for(let u of this._def.checks)if(u.kind==="min")r.data.length<u.value&&(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),e.dirty());else if(u.kind==="max")r.data.length>u.value&&(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),e.dirty());else if(u.kind==="length"){let d=r.data.length>u.value,m=r.data.length<u.value;(d||m)&&(c=this._getOrReturnCtx(r,c),d?Xe(c,{code:Ie.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):m&&Xe(c,{code:Ie.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),e.dirty())}else if(u.kind==="email")rie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"email",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="emoji")x2||(x2=new RegExp(aie,"u")),x2.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"emoji",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="uuid")Zne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"uuid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="nanoid")Jne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"nanoid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="cuid")Kne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cuid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="cuid2")Xne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cuid2",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="ulid")Yne.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"ulid",code:Ie.invalid_string,message:u.message}),e.dirty());else if(u.kind==="url")try{new URL(r.data)}catch{c=this._getOrReturnCtx(r,c),Xe(c,{validation:"url",code:Ie.invalid_string,message:u.message}),e.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"regex",code:Ie.invalid_string,message:u.message}),e.dirty())):u.kind==="trim"?r.data=r.data.trim():u.kind==="includes"?r.data.includes(u.value,u.position)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),e.dirty()):u.kind==="toLowerCase"?r.data=r.data.toLowerCase():u.kind==="toUpperCase"?r.data=r.data.toUpperCase():u.kind==="startsWith"?r.data.startsWith(u.value)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{startsWith:u.value},message:u.message}),e.dirty()):u.kind==="endsWith"?r.data.endsWith(u.value)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:{endsWith:u.value},message:u.message}),e.dirty()):u.kind==="datetime"?f9(u).test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"datetime",message:u.message}),e.dirty()):u.kind==="date"?uie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"date",message:u.message}),e.dirty()):u.kind==="time"?fie(u).test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{code:Ie.invalid_string,validation:"time",message:u.message}),e.dirty()):u.kind==="duration"?tie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"duration",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="ip"?pie(r.data,u.version)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"ip",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="jwt"?die(r.data,u.alg)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"jwt",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="cidr"?hie(r.data,u.version)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"cidr",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="base64"?cie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"base64",code:Ie.invalid_string,message:u.message}),e.dirty()):u.kind==="base64url"?lie.test(r.data)||(c=this._getOrReturnCtx(r,c),Xe(c,{validation:"base64url",code:Ie.invalid_string,message:u.message}),e.dirty()):$t.assertNever(u);return{status:e.value,value:r.data}}_regex(r,t,e){return this.refinement(c=>r.test(c),{validation:t,code:Ie.invalid_string,...ct.errToObj(e)})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}email(r){return this._addCheck({kind:"email",...ct.errToObj(r)})}url(r){return this._addCheck({kind:"url",...ct.errToObj(r)})}emoji(r){return this._addCheck({kind:"emoji",...ct.errToObj(r)})}uuid(r){return this._addCheck({kind:"uuid",...ct.errToObj(r)})}nanoid(r){return this._addCheck({kind:"nanoid",...ct.errToObj(r)})}cuid(r){return this._addCheck({kind:"cuid",...ct.errToObj(r)})}cuid2(r){return this._addCheck({kind:"cuid2",...ct.errToObj(r)})}ulid(r){return this._addCheck({kind:"ulid",...ct.errToObj(r)})}base64(r){return this._addCheck({kind:"base64",...ct.errToObj(r)})}base64url(r){return this._addCheck({kind:"base64url",...ct.errToObj(r)})}jwt(r){return this._addCheck({kind:"jwt",...ct.errToObj(r)})}ip(r){return this._addCheck({kind:"ip",...ct.errToObj(r)})}cidr(r){return this._addCheck({kind:"cidr",...ct.errToObj(r)})}datetime(r){var t,e;return typeof r=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:r}):this._addCheck({kind:"datetime",precision:typeof r?.precision>"u"?null:r?.precision,offset:(t=r?.offset)!==null&&t!==void 0?t:!1,local:(e=r?.local)!==null&&e!==void 0?e:!1,...ct.errToObj(r?.message)})}date(r){return this._addCheck({kind:"date",message:r})}time(r){return typeof r=="string"?this._addCheck({kind:"time",precision:null,message:r}):this._addCheck({kind:"time",precision:typeof r?.precision>"u"?null:r?.precision,...ct.errToObj(r?.message)})}duration(r){return this._addCheck({kind:"duration",...ct.errToObj(r)})}regex(r,t){return this._addCheck({kind:"regex",regex:r,...ct.errToObj(t)})}includes(r,t){return this._addCheck({kind:"includes",value:r,position:t?.position,...ct.errToObj(t?.message)})}startsWith(r,t){return this._addCheck({kind:"startsWith",value:r,...ct.errToObj(t)})}endsWith(r,t){return this._addCheck({kind:"endsWith",value:r,...ct.errToObj(t)})}min(r,t){return this._addCheck({kind:"min",value:r,...ct.errToObj(t)})}max(r,t){return this._addCheck({kind:"max",value:r,...ct.errToObj(t)})}length(r,t){return this._addCheck({kind:"length",value:r,...ct.errToObj(t)})}nonempty(r){return this.min(1,ct.errToObj(r))}trim(){return new a({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new a({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(r=>r.kind==="datetime")}get isDate(){return!!this._def.checks.find(r=>r.kind==="date")}get isTime(){return!!this._def.checks.find(r=>r.kind==="time")}get isDuration(){return!!this._def.checks.find(r=>r.kind==="duration")}get isEmail(){return!!this._def.checks.find(r=>r.kind==="email")}get isURL(){return!!this._def.checks.find(r=>r.kind==="url")}get isEmoji(){return!!this._def.checks.find(r=>r.kind==="emoji")}get isUUID(){return!!this._def.checks.find(r=>r.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(r=>r.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(r=>r.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(r=>r.kind==="cuid2")}get isULID(){return!!this._def.checks.find(r=>r.kind==="ulid")}get isIP(){return!!this._def.checks.find(r=>r.kind==="ip")}get isCIDR(){return!!this._def.checks.find(r=>r.kind==="cidr")}get isBase64(){return!!this._def.checks.find(r=>r.kind==="base64")}get isBase64url(){return!!this._def.checks.find(r=>r.kind==="base64url")}get minLength(){let r=null;for(let t of this._def.checks)t.kind==="min"&&(r===null||t.value>r)&&(r=t.value);return r}get maxLength(){let r=null;for(let t of this._def.checks)t.kind==="max"&&(r===null||t.value<r)&&(r=t.value);return r}};es.create=a=>{var r;return new es({checks:[],typeName:vt.ZodString,coerce:(r=a?.coerce)!==null&&r!==void 0?r:!1,...Tt(a)})};function mie(a,r){let t=(a.toString().split(".")[1]||"").length,e=(r.toString().split(".")[1]||"").length,c=t>e?t:e,u=parseInt(a.toFixed(c).replace(".","")),d=parseInt(r.toFixed(c).replace(".",""));return u%d/Math.pow(10,c)}var Gs=class a extends At{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(r){if(this._def.coerce&&(r.data=Number(r.data)),this._getType(r)!==rt.number){let u=this._getOrReturnCtx(r);return Xe(u,{code:Ie.invalid_type,expected:rt.number,received:u.parsedType}),bt}let e,c=new ga;for(let u of this._def.checks)u.kind==="int"?$t.isInteger(r.data)||(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.invalid_type,expected:"integer",received:"float",message:u.message}),c.dirty()):u.kind==="min"?(u.inclusive?r.data<u.value:r.data<=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),c.dirty()):u.kind==="max"?(u.inclusive?r.data>u.value:r.data>=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),c.dirty()):u.kind==="multipleOf"?mie(r.data,u.value)!==0&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_multiple_of,multipleOf:u.value,message:u.message}),c.dirty()):u.kind==="finite"?Number.isFinite(r.data)||(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_finite,message:u.message}),c.dirty()):$t.assertNever(u);return{status:c.value,value:r.data}}gte(r,t){return this.setLimit("min",r,!0,ct.toString(t))}gt(r,t){return this.setLimit("min",r,!1,ct.toString(t))}lte(r,t){return this.setLimit("max",r,!0,ct.toString(t))}lt(r,t){return this.setLimit("max",r,!1,ct.toString(t))}setLimit(r,t,e,c){return new a({...this._def,checks:[...this._def.checks,{kind:r,value:t,inclusive:e,message:ct.toString(c)}]})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}int(r){return this._addCheck({kind:"int",message:ct.toString(r)})}positive(r){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ct.toString(r)})}negative(r){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ct.toString(r)})}nonpositive(r){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ct.toString(r)})}nonnegative(r){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ct.toString(r)})}multipleOf(r,t){return this._addCheck({kind:"multipleOf",value:r,message:ct.toString(t)})}finite(r){return this._addCheck({kind:"finite",message:ct.toString(r)})}safe(r){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ct.toString(r)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ct.toString(r)})}get minValue(){let r=null;for(let t of this._def.checks)t.kind==="min"&&(r===null||t.value>r)&&(r=t.value);return r}get maxValue(){let r=null;for(let t of this._def.checks)t.kind==="max"&&(r===null||t.value<r)&&(r=t.value);return r}get isInt(){return!!this._def.checks.find(r=>r.kind==="int"||r.kind==="multipleOf"&&$t.isInteger(r.value))}get isFinite(){let r=null,t=null;for(let e of this._def.checks){if(e.kind==="finite"||e.kind==="int"||e.kind==="multipleOf")return!0;e.kind==="min"?(t===null||e.value>t)&&(t=e.value):e.kind==="max"&&(r===null||e.value<r)&&(r=e.value)}return Number.isFinite(t)&&Number.isFinite(r)}};Gs.create=a=>new Gs({checks:[],typeName:vt.ZodNumber,coerce:a?.coerce||!1,...Tt(a)});var Qs=class a extends At{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(r){if(this._def.coerce)try{r.data=BigInt(r.data)}catch{return this._getInvalidInput(r)}if(this._getType(r)!==rt.bigint)return this._getInvalidInput(r);let e,c=new ga;for(let u of this._def.checks)u.kind==="min"?(u.inclusive?r.data<u.value:r.data<=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),c.dirty()):u.kind==="max"?(u.inclusive?r.data>u.value:r.data>=u.value)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),c.dirty()):u.kind==="multipleOf"?r.data%u.value!==BigInt(0)&&(e=this._getOrReturnCtx(r,e),Xe(e,{code:Ie.not_multiple_of,multipleOf:u.value,message:u.message}),c.dirty()):$t.assertNever(u);return{status:c.value,value:r.data}}_getInvalidInput(r){let t=this._getOrReturnCtx(r);return Xe(t,{code:Ie.invalid_type,expected:rt.bigint,received:t.parsedType}),bt}gte(r,t){return this.setLimit("min",r,!0,ct.toString(t))}gt(r,t){return this.setLimit("min",r,!1,ct.toString(t))}lte(r,t){return this.setLimit("max",r,!0,ct.toString(t))}lt(r,t){return this.setLimit("max",r,!1,ct.toString(t))}setLimit(r,t,e,c){return new a({...this._def,checks:[...this._def.checks,{kind:r,value:t,inclusive:e,message:ct.toString(c)}]})}_addCheck(r){return new a({...this._def,checks:[...this._def.checks,r]})}positive(r){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ct.toString(r)})}negative(r){return this._addCheck({kind:"max",value:BigInt(0),incl